# 模块7-主题书目 开发文档

## 1. 功能概述
旨在通过每日追踪特定RSS源，利用大模型对文章进行分析（评分、打标签、总结），并将结果结构化存储，为后续生成书目候选主题提供数据基础。

## 2. 架构设计

### 2.1 目录结构
```
src/core/subject_bibliography/
├── __init__.py
├── rss_fetcher.py      # RSS抓取与解析
├── processor.py        # LLM分析处理
├── storage.py          # 数据存储（Excel）
└── pipeline.py         # 流程控制
```

### 2.2 配置文件
配置文件路径：`config/subject_bibliography.yaml`
配置项包括：
- RSS源列表（名称、URL）
- 抓取时间范围（hours_lookback 或 time_range.start/end）
- 输出目录
- LLM相关配置（Prompt模板等）

## 3. 详细设计

### 3.1 RSS抓取 (rss_fetcher.py)
- 使用 `feedparser` 库解析RSS。
- `fetch_recent_articles(feeds, hours_lookback, start_time=None, end_time=None)`: 兼容“回溯N小时”与“起止时间”两种过滤方式。
- 数据标准化：提取 Title, Link, Published Date, Summary, Source Name。

### 3.2 LLM分析 (processor.py)
- 复用 `src.utils.llm`。
- `analyze_article(article_content)`: 发送文章内容给LLM，获取JSON格式的分析结果。
- 分析维度：
  ```
  {
    "decision": <Boolean, true 表示保留，false 表示忽略>,
    "score": <Integer, 0-100, 评分。0-59:忽略（触犯负面清单或无价值）; 60-75:勉强保留（有一点价值但不出彩）; 76-85:推荐（符合某一原则，质量不错）; 86-100:极佳（完美符合一到多个原则，极具启发性）>,
    "primary_dimension": <String, 文章最符合的四大原则之一，若都不符合则填 "None">,
    "summary": <String, 100字以内的中文总结，概括核心观点>,
    "reason": <String, 50字以内，解释评分理由，明确指出它符合或违反了哪条原则>,
    "tags": [<String, 标签1>, <String, 标签2>, ...],
    "keywords": [<String, 核心实体或概念1>, <String, 核心实体或概念2>, ...],
    "mentioned_books": [
      { "title": "<String, 书名>", "author": "<String, 作者(若文中未提可留空)>" },
      ... // 提取文章中明确提及、引用或推荐的所有图书。若无则为空数组 []
    ],
    "book_clues": [
      "<String, 推荐方向或书名>",
      ... // 基于文章主题，你凭借自身知识库联想到的2-3个延伸主题阅读方向。不要重复 mentioned_books 中的内容。
    ]
  }
  ```
### 3.3 数据存储 (storage.py)
- 使用 `pandas` 或 `openpyxl` 操作Excel。
- `save_results(results, output_dir)`: 将分析结果追加到当月/当日的Excel文件中。
- 字段：Source, Title, Link, PubDate, FetchDate, Score, Tags, Keywords, LLM_Summary, Logic, Original_Summary.

## 4. 依赖项
- feedparser
- pandas
- openpyxl

---

# 模块7-主题书目 (第一阶段) 实现总结

## 已完成工作

### 1. 文档与配置
- [NEW] 创建开发文档: [docs/changelogs/模块7-主题书目/开发文档.md](file:///f:/Github/Library-AI-demos/book-echoes/docs/changelogs/%E6%A8%A1%E5%9D%977-%E4%B8%BB%E9%A2%98%E4%B9%A6%E7%9B%AE/%E5%BC%80%E5%8F%91%E6%96%87%E6%A1%A3.md)
- [NEW] 创建配置文件: [config/subject_bibliography.yaml](file:///f:/Github/Library-AI-demos/book-echoes/config/subject_bibliography.yaml)
- [NEW] 创建 Prompt 文件: [prompts/subject_bibliography_analysis.md](file:///f:/Github/Library-AI-demos/book-echoes/prompts/subject_bibliography_analysis.md)
- [MODIFY] 更新 LLM 配置: [config/llm.yaml](file:///f:/Github/Library-AI-demos/book-echoes/config/llm.yaml) (添加 `subject_bibliography_analysis` 任务)

### 2. 核心代码
- [NEW] [src/core/subject_bibliography/rss_fetcher.py](file:///f:/Github/Library-AI-demos/book-echoes/src/core/subject_bibliography/rss_fetcher.py): 实现 RSS 抓取与解析。
- [NEW] [src/core/subject_bibliography/processor.py](file:///f:/Github/Library-AI-demos/book-echoes/src/core/subject_bibliography/processor.py): 复用 [UnifiedLLMClient](file:///f:/Github/Library-AI-demos/book-echoes/src/utils/llm/client.py#75-369) 实现文章分析。
- [NEW] [src/core/subject_bibliography/storage.py](file:///f:/Github/Library-AI-demos/book-echoes/src/core/subject_bibliography/storage.py): 实现 Excel 数据存储与去重。
- [NEW] [src/core/subject_bibliography/pipeline.py](file:///f:/Github/Library-AI-demos/book-echoes/src/core/subject_bibliography/pipeline.py): 串联整个流程。

### 3. 集成
- [MODIFY] [main.py](file:///f:/Github/Library-AI-demos/book-echoes/main.py): 添加模块7菜单选项 [run_module7](file:///f:/Github/Library-AI-demos/book-echoes/main.py#609-630)。

## 验证结果
- 运行了 RSS Fetcher 测试脚本，成功从 Wikipedia RSS 源抓取到文章。
- 确认 `feedparser` 库已安装。

## 下一步建议
- 观察 LLM 分析效果，根据需要调整 Prompt。
- 添加更多高质量的 RSS 源到配置文件中。
- 开发第二阶段功能：月底汇总与主题生成。


