# LLM评分统计功能说明

## 功能概述

在文章LLM分析完成后，系统会自动弹出交互式提示，询问用户是否需要对文章评分进行统计分析。

## 功能特性

### 1. 交互式提示
- **提示时机**: 阶段3（LLM评估）完成后
- **默认选项**: 是（y）
- **超时设置**: 10秒内无输入自动选择默认值
- **输入选项**: 
  - `y` / `yes` / `是` - 执行统计分析
  - `n` / `no` / `否` - 跳过统计分析

### 2. 评分统计分析

#### 分数段划分（无重叠）
- **95以上**: [95, ∞)
- **93-95**: [93, 95)
- **90-93**: [90, 93)
- **85-90**: [85, 90)
- **85以下**: [0, 85)

#### 统计内容
- 文章总数
- 有效评分数量
- 各分数段的数量和占比
- 平均分、最高分、最低分

### 3. 报告生成

#### 报告位置
- 与Excel文件同目录
- 文件名格式: `{Excel文件名}_评分统计报告.txt`
- 例如: `runtime/outputs/2025-12_评分统计报告.txt`

#### 报告格式
```
============================================================
LLM文章评分统计分析报告
============================================================

生成时间: 2025-12-07 09:45:16
文章总数: 14
有效评分: 11

评分统计:
  平均分: 89.73
  最高分: 98.0
  最低分: 80.0

分数段分布:
------------------------------------------------------------
分数段             数量         占比         范围                  
------------------------------------------------------------
95以上            2            18.2%    95-∞                
93-95           2            18.2%    93-95               
90-93           2            18.2%    90-93               
85-90           3            27.3%    85-90               
85以下            2            18.2%    0-85                
------------------------------------------------------------

============================================================
```

## 模块设计

### 核心模块
- **文件**: `src/core/score_statistics.py`
- **类**: `ScoreStatistics`
- **设计原则**: 单一职责，高内聚低耦合

### 主要方法

#### `analyze_scores(articles)`
分析文章评分分布，返回统计结果字典

#### `generate_report(statistics, output_path)`
生成统计报告文本文件

#### `run_analysis(articles, excel_path)`
执行完整的统计分析流程（分析 + 生成报告）

## 使用方式

### 命令行运行
```bash
# 运行阶段3（LLM评估）
python main.py --stage analyze

# 完成后会自动弹出提示
# 是否对文章评分（llm_score列）进行统计分析？
# (默认为 'y'，10秒内无输入将自动选择默认值)
# 请输入 (y/n): 
```

### 独立测试
```bash
# 运行测试脚本
python test_score_statistics.py
```

## 技术实现

### 超时输入处理
- **Windows平台**: 使用 `msvcrt` 模块实现非阻塞输入
- **Unix/Linux平台**: 使用 `select` 模块实现超时控制

### 数据过滤
- 自动过滤无效评分（None、NaN、空字符串）
- 只统计大于0的有效评分
- 处理字符串类型的评分值

### 错误处理
- 交互式提示失败时自动跳过，不影响主流程
- 统计分析失败时记录错误日志，不中断程序

## 注意事项

1. **分数段不重叠**: 各分数段采用左闭右开区间 `[min, max)`，确保每个分数只属于一个分数段
2. **默认自动执行**: 10秒内无输入会自动执行统计（默认为"是"）
3. **独立模块**: 统计功能独立于主流程，可单独调用和测试
4. **报告位置**: 报告文件与Excel文件存储在同一目录
