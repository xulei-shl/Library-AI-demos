# 任务名配置说明

## 问题

在 `config/subject_bibliography.yaml` 中有这样的配置:

```yaml
llm_analysis:
  task_name: "network_article_initial_review"
```

但在 `config/llm.yaml` 中,双 Agent 使用的任务名是 `article_filter` 和 `article_analysis`,这是为什么?

## 答案

### 简短回答

**`task_name: "network_article_initial_review"` 这个配置已经废弃了,不再使用。**

双 Agent 架构使用的任务名是**硬编码**在代码中的:
- Agent 1 (Filter): `"article_filter"`
- Agent 2 (Analyst): `"article_analysis"`

### 详细说明

#### 1. 旧架构 (已废弃)

**配置方式:**
```yaml
# config/subject_bibliography.yaml
llm_analysis:
  task_name: "network_article_initial_review"
```

**代码使用:**
```python
# src/core/pipeline.py (旧版本)
llm_task_name = self.config.get("llm_analysis", {}).get("task_name", "...")
processor = ArticleProcessor(task_name=llm_task_name)
```

**问题:** 只有一个 Agent,所有分析都用同一个任务配置。

#### 2. 新架构 (双 Agent)

**配置方式:**
```yaml
# config/llm.yaml
tasks:
  article_filter:      # Agent 1 的任务配置
    provider_type: text-small
    temperature: 0.3
    prompt:
      source: "prompts/article_filter.md"
  
  article_analysis:    # Agent 2 的任务配置
    provider_type: text
    temperature: 0.5
    prompt:
      source: "prompts/article_analysis.md"
```

**代码使用:**
```python
# src/core/analysis/filter.py
class ArticleFilter:
    def __init__(self, task_name: str = "article_filter"):  # 硬编码默认值
        self.task_name = task_name

# src/core/analysis/analyst.py
class ArticleAnalyst:
    def __init__(self, task_name: str = "article_analysis"):  # 硬编码默认值
        self.task_name = task_name

# src/core/article_analyzer.py
class ArticleProcessor:
    def __init__(self):
        self.filter_agent = ArticleFilter()      # 使用默认的 "article_filter"
        self.analyst_agent = ArticleAnalyst()    # 使用默认的 "article_analysis"
```

**优势:** 
- 两个 Agent 使用不同的模型和参数
- 初筛用小模型 (gpt-4o-mini),省钱
- 深度分析用大模型 (gemini-2.5-pro),保证质量

#### 3. 为什么保留旧配置?

```yaml
llm_analysis:
  task_name: "network_article_initial_review"  # [已废弃] 保留用于向后兼容
```

**原因:**
1. **向后兼容**: 避免旧配置文件报错
2. **文档参考**: 让用户知道这个字段曾经存在
3. **平滑过渡**: 如果将来需要回退,可以快速恢复

**实际上:** 这个配置在新代码中**完全不会被读取**。

## 总结

| 项目 | 旧架构 | 新架构 (双 Agent) |
|------|--------|-------------------|
| 配置位置 | `subject_bibliography.yaml` | `llm.yaml` |
| 任务名来源 | 从配置文件读取 | 代码中硬编码 |
| 任务数量 | 1 个 | 2 个 |
| Agent 1 | - | `article_filter` |
| Agent 2 | - | `article_analysis` |
| `task_name` 配置 | 使用中 | **已废弃** |

## 如何修改任务配置?

### 修改 Agent 1 (初筛) 的配置:

编辑 `config/llm.yaml` 中的 `article_filter` 部分:

```yaml
article_filter:
  provider_type: text-small  # 可以改成 text 使用大模型
  temperature: 0.3           # 可以调整温度
  prompt:
    source: "prompts/article_filter.md"  # 可以换成其他 prompt 文件
```

### 修改 Agent 2 (深度分析) 的配置:

编辑 `config/llm.yaml` 中的 `article_analysis` 部分:

```yaml
article_analysis:
  provider_type: text        # 可以改成 text-small 省钱
  temperature: 0.5           # 可以调整温度
  prompt:
    source: "prompts/article_analysis.md"  # 可以换成其他 prompt 文件
```

### 如果想改任务名?

需要修改代码:

```python
# src/core/analysis/filter.py
def __init__(self, task_name: str = "你的新任务名"):
    ...

# src/core/analysis/analyst.py
def __init__(self, task_name: str = "你的新任务名"):
    ...
```

**不推荐这样做**,除非你有特殊需求。

## 常见问题

### Q: 为什么不从配置文件读取任务名?

**A:** 因为双 Agent 架构的任务名是固定的,不需要灵活配置。硬编码可以:
- 减少配置复杂度
- 避免配置错误
- 代码更清晰

### Q: 如果我想用旧的单 Agent 模式怎么办?

**A:** 保留了 `network_article_initial_review` 任务配置,但需要修改代码:

```python
# src/core/pipeline.py
# 改回旧版本的初始化方式
processor = ArticleProcessor(task_name="network_article_initial_review")
```

**不推荐**,因为会失去双 Agent 的优势。

### Q: 我可以删除 `llm_analysis.task_name` 这个配置吗?

**A:** 可以,但不建议。保留它可以:
- 提醒这个字段曾经存在
- 避免其他依赖这个字段的代码报错
- 作为文档参考

## 参考文档

- `docs/LLM评论重构开发文档.md` - 重构设计文档
- `docs/LLM评论重构完成总结.md` - 重构完成总结
- `docs/Pipeline更新说明.md` - Pipeline 集成说明
