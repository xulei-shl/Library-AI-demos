# 图书检索系统文件打包清单

## 打包说明

本文档列出了需要打包的所有相关文件，按目录结构组织，便于新项目复制使用。

## 第一阶段：核心业务逻辑 (必需)

### 1.1 图书向量化核心模块
```
src/core/book_vectorization/
├── __init__.py
├── retriever.py                    # 核心检索接口 - 最重要
├── query_assets.py                 # MD文档解析和查询资产提取
├── fusion.py                       # 结果融合算法
├── embedding_client.py             # 文本向量化客户端
├── vector_store.py                 # 向量存储管理 (需适配)
├── database_reader.py              # 数据库读取 (需适配)
├── reranker.py                     # 结果重排序 (可选)
├── vectorizer.py                   # 向量化控制器
├── filter.py                       # 数据过滤 (可选)
├── output_formatter.py             # 结果格式化
├── json_parser.py                  # JSON解析工具
├── excel_exporter.py               # Excel导出 (可选)
├── excel_enhancer.py               # Excel增强 (可选)
├── excel_reader.py                 # Excel读取 (可选)
├── theme_screener.py               # 主题筛选 (可选)
└── recommendation_writer.py        # 推荐导语生成 (可选)
```

### 1.2 LLM客户端模块 (必需)
```
src/utils/llm/
├── __init__.py
├── client.py                       # 统一LLM客户端 - 最重要
├── config_loader.py                # LLM配置加载
├── exceptions.py                   # LLM异常定义
├── json_utils.py                   # JSON处理工具
├── prompt_loader.py                # 提示词加载器
└── retry.py                        # 重试管理器
```

### 1.3 通用工具模块 (必需)
```
src/utils/
├── __init__.py
├── config_manager.py               # 配置管理器
├── logger.py                       # 日志系统
├── file_utils.py                   # 文件工具
├── time_utils.py                   # 时间工具
├── rule_file_parser.py             # 规则解析器
└── migrate_status_fields.py        # 数据迁移工具
```

### 1.4 配置目录 (必需)
```
config/
├── book_vectorization.yaml         # 图书向量化配置
├── llm.yaml                        # LLM配置
└── .env.example                    # 环境变量模板
```

## 第二阶段：命令行工具 (可选但推荐)

### 2.1 主要脚本
```
scripts/
├── retrieve_books.py               # 主检索脚本 - 重要参考
├── vectorize_books.py              # 向量化脚本
├── query-samples.txt               # 查询示例
└── run_migration.py                # 迁移脚本
```

### 2.2 数据库迁移
```
scripts/
└── migrate_add_embedding_fields.sql    # 数据库结构迁移SQL
```

## 第三阶段：项目配置文件 (可选)

### 3.1 Python项目配置
```
requirements.txt                    # Python依赖包列表
main.py                            # 如果存在的话
```

### 3.2 文档目录 (参考用)
```
docs/
├── nextjs_integration_architecture.md    # 架构设计文档
├── 代码文件整理清单与说明.md             # 文件说明文档
├── implementation_plan.md               # 实施计划
└── [其他相关文档...]
```

## 新项目目录结构建议

复制后的新项目结构：

```
book-retrieval-api/
├── src/
│   ├── core/
│   │   └── book_vectorization/          # 复制所有核心模块
│   └── utils/
│       ├── llm/                         # 复制所有LLM工具
│       ├── config_manager.py
│       ├── logger.py
│       ├── file_utils.py
│       └── time_utils.py
├── config/
│   ├── book_vectorization.yaml          # 复制并修改
│   ├── llm.yaml                         # 复制并修改
│   └── .env.example
├── scripts/
│   ├── retrieve_books.py                # 参考实现
│   └── migrate_add_embedding_fields.sql
├── api/                                 # 新建：API服务
│   ├── main.py                         # FastAPI应用
│   ├── routes/                         # API路由
│   └── models/                         # 数据模型
├── tests/                              # 新建：测试文件
├── requirements.txt                     # 新建：依赖管理
└── README.md                           # 新建：项目说明
```

## 文件复制优先级

### 第一优先级 (立即复制)
1. `src/core/book_vectorization/retriever.py`
2. `src/core/book_vectorization/query_assets.py`
3. `src/core/book_vectorization/fusion.py`
4. `src/utils/llm/client.py`
5. `src/utils/config_manager.py`
6. `src/utils/logger.py`
7. `config/book_vectorization.yaml`
8. `config/llm.yaml`

### 第二优先级 (尽快复制)
1. `src/core/book_vectorization/embedding_client.py`
2. `src/core/book_vectorization/vector_store.py` (需要适配)
3. `src/core/book_vectorization/database_reader.py` (需要适配)
4. `src/utils/file_utils.py`
5. `src/utils/time_utils.py`
6. `src/utils/llm/` 目录下的其他文件

### 第三优先级 (可选复制)
1. `scripts/retrieve_books.py` (参考实现)
2. 其他核心模块的完整实现
3. 可选功能模块

## 适配修改点

### 1. 数据库适配
**需要修改的文件**:
- `src/core/book_vectorization/vector_store.py`
- `src/core/book_vectorization/database_reader.py`

**修改方向**:
- `vector_store.py`: ChromaDB → Pinecone
- `database_reader.py`: SQLite → PostgreSQL/MongoDB

### 2. 配置适配
**需要修改的文件**:
- `config/book_vectorization.yaml`
- `config/llm.yaml`

**修改方向**:
- 更新数据库连接信息
- 更新API密钥配置
- 调整向量数据库参数

### 3. API封装
**新建文件**:
- `api/main.py`: FastAPI应用入口
- `api/routes/search.py`: 检索API路由
- `api/routes/expand.py`: 扩展检索API路由
- `api/models/request.py`: 请求模型
- `api/models/response.py`: 响应模型

## 复制命令建议

```bash
# 创建新项目目录
mkdir book-retrieval-api
cd book-retrieval-api

# 复制核心模块
cp -r ../src/core/book_vectorization ./src/
cp -r ../src/utils/llm ./src/utils/
cp ../src/utils/config_manager.py ./src/utils/
cp ../src/utils/logger.py ./src/utils/
cp ../src/utils/file_utils.py ./src/utils/
cp ../src/utils/time_utils.py ./src/utils/

# 复制配置文件
cp ../config/book_vectorization.yaml ./config/
cp ../config/llm.yaml ./config/
cp ../config/.env.example ./config/

# 复制参考脚本
cp ../scripts/retrieve_books.py ./scripts/
cp ../scripts/migrate_add_embedding_fields.sql ./scripts/
```

## 验证清单

复制完成后，检查以下文件是否存在：

### 核心模块检查
- [ ] `src/core/book_vectorization/retriever.py`
- [ ] `src/core/book_vectorization/query_assets.py`
- [ ] `src/core/book_vectorization/fusion.py`
- [ ] `src/utils/llm/client.py`
- [ ] `src/utils/config_manager.py`
- [ ] `src/utils/logger.py`

### 配置检查
- [ ] `config/book_vectorization.yaml`
- [ ] `config/llm.yaml`
- [ ] `config/.env.example`

### 工具检查
- [ ] `src/utils/file_utils.py`
- [ ] `src/utils/time_utils.py`

## 下一步行动

1. 按照优先级顺序复制文件
2. 优先处理第一优先级的核心模块
3. 依次适配数据库和配置
4. 开始API封装工作
5. 进行功能测试和调试

通过这个清单，可以系统性地将现有代码迁移到新项目中，为后续的API开发和Web界面集成奠定坚实基础。