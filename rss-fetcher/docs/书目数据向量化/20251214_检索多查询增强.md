# 开发变更记录
- **日期**: 2025-12-14
- **对应设计文档**: [docs/书目数据向量化/检索相关性优化实践.md](../书目数据向量化/检索相关性优化实践.md)

## 1. 变更摘要
- 新增 Markdown 检索资产解析、查询包管理、结果融合与 rerank 支撑模块，完成多子查询检索闭环。
- 扩展 `BookRetriever` 与 CLI，支持 `--from-md` 自动解析、按配置执行多轮检索、可选 SiliconFlow reranker。
- 同步更新配置与单元测试，确保新参数与流程可回归验证。

## 2. 文件清单
- `config/book_vectorization.yaml`: 新增 multi_query / fusion / reranker 配置块。
- `config/llm.yaml`: 增补 `query_assets_expansion` 任务占位。
- `src/core/book_vectorization/query_assets.py`: 新增 Markdown 解析与查询包构建模块。
- `src/core/book_vectorization/fusion.py`: 新增多子查询结果融合工具。
- `src/core/book_vectorization/reranker.py`: 新增 SiliconFlow reranker 客户端封装。
- `src/core/book_vectorization/retriever.py`: 接入多子查询、融合与 rerank 流程。
- `scripts/retrieve_books.py`: CLI 支持 `--from-md`、`--per-query-top-k`、`--final-top-k`、`--enable-rerank` 等参数。
- `tests/test_book_vectorization/test_retrieve_books_cli.py`: 更新并新增多查询回归测试。

## 3. 测试结果
- [x] 单元测试通过：`pytest tests/test_book_vectorization/test_retrieve_books_cli.py`
- [ ] 核心路径验证通过
