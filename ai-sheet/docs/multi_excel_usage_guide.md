# 多Excel多Sheet功能使用指南

## 快速开始

### 1. 启动应用
```bash
python main.py
```

### 2. 选择多Excel上传Tab
点击 "📊 多Excel上传" 选项卡

### 3. 基本操作流程

#### 步骤1：添加第一个Excel文件
1. 点击 "浏览" 按钮
2. 选择Excel文件（.xlsx 或 .xls）
3. 系统自动加载Sheet列表
4. 从下拉菜单选择需要的Sheet

#### 步骤2：添加更多文件（可选）
1. 点击 "➕ 添加" 按钮
2. 重复步骤1的操作
3. 可以添加多个文件-Sheet组合

#### 步骤3：查看预览
- 右侧预览区域实时显示选择的数据
- 显示每个文件-Sheet的前5行数据
- 包含文件信息和数据统计

#### 步骤4：保存选择
1. 点击 "💾 保存选择" 按钮
2. 数据保存到临时文件，供其他Tab使用

#### 步骤5：在公式生成中使用
1. 切换到 "🧮 公式生成" Tab
2. 列选择器中会显示所有选择的文件-Sheet列信息
3. 样本数据区域显示组合预览

## 界面说明

### 左侧选择区域
```
📊 Excel文件和Sheet选择
┌─────────────────────────────────────┐
│ Excel文件: [下拉菜单] [浏览] [删除]    │
│ Sheet:    [下拉菜单]                │
├─────────────────────────────────────┤
│ Excel文件: [下拉菜单] [浏览] [删除]    │
│ Sheet:    [下拉菜单]                │
└─────────────────────────────────────┘
[🔄 刷新预览] [🗑️ 清除所有] [💾 保存选择]
```

### 右侧预览区域
```
👁️ 数据预览
已选择 2 个文件，3 个Sheet

## 📊 文件1.xlsx - Sheet1
**总行数:** 100 | **列数:** 5
| A-姓名 | B-年龄 | C-城市 | D-薪资 | E-部门 |
|--------|--------|--------|--------|--------|
| 张三   | 25     | 北京   | 8000   | 技术部 |
| 李四   | 30     | 上海   | 12000  | 销售部 |
...

## 📊 文件2.xlsx - Sheet1
**总行数:** 50 | **列数:** 3
| A-产品 | B-价格 | C-库存 |
|--------|--------|--------|
| 产品A  | 100    | 50     |
| 产品B  | 200    | 30     |
...
```

## 高级功能

### 1. 动态管理选择器
- **添加选择器**：点击 "➕ 添加" 按钮
- **删除选择器**：点击选择器右侧的 "删除" 按钮
- **最少限制**：至少保留一个选择器

### 2. 文件管理
- **重复文件**：同一文件可以选择多个Sheet
- **文件缓存**：已加载的文件会被缓存，提高性能
- **自动更新**：选择变化时自动更新预览

### 3. 数据预览
- **实时更新**：选择变化时实时更新预览
- **结构化显示**：每个文件-Sheet独立显示
- **统计信息**：显示行数、列数等统计信息

### 4. 与其他Tab集成
- **公式生成**：列信息格式为 `[文件名-Sheet名] A列-列名`
- **数据共享**：通过共享数据机制与其他Tab通信
- **临时文件**：数据保存到临时文件供跨Tab使用

## 常见问题

### Q1: 支持哪些文件格式？
A: 支持 .xlsx 和 .xls 格式的Excel文件

### Q2: 文件大小有限制吗？
A: 默认限制为50MB，可在配置中修改

### Q3: 最多可以选择多少个文件？
A: 理论上没有限制，但建议不超过10个文件以保证性能

### Q4: 如何删除已选择的文件？
A: 点击对应选择器右侧的 "删除" 按钮

### Q5: 预览数据不完整怎么办？
A: 预览只显示前5行数据，完整数据在处理时会全部加载

### Q6: 如何在公式生成中使用多文件数据？
A: 保存选择后，切换到公式生成Tab，系统会自动加载多文件数据

### Q7: 临时文件保存在哪里？
A: 保存在 `logs/` 目录下，包括预览文件和选择信息

### Q8: 如何清除所有选择？
A: 点击 "🗑️ 清除所有" 按钮

### Q9: 选择器最少需要几个？
A: 至少需要保留一个选择器

### Q10: 如何刷新预览？
A: 点击 "🔄 刷新预览" 按钮或重新选择文件/Sheet

## 错误处理

### 文件错误
- **文件不存在**：检查文件路径是否正确
- **格式不支持**：确保文件为Excel格式
- **文件损坏**：尝试用Excel打开文件检查完整性
- **文件过大**：检查文件大小是否超过限制

### 数据错误
- **Sheet为空**：选择包含数据的Sheet
- **编码问题**：确保Excel文件编码正确
- **权限问题**：确保文件没有被其他程序占用

### 界面错误
- **预览不更新**：点击刷新预览按钮
- **选择器异常**：清除所有选择后重新开始
- **内存不足**：减少同时加载的文件数量

## 性能优化建议

### 1. 文件选择
- 优先选择数据量适中的文件
- 避免同时加载过多大文件
- 定期清理不需要的选择

### 2. 数据处理
- 利用预览功能确认数据正确性
- 及时保存选择避免重复操作
- 合理使用缓存机制

### 3. 系统资源
- 定期清理临时文件
- 关闭不需要的Tab
- 监控内存使用情况

## 最佳实践

### 1. 文件组织
```
推荐的文件结构：
project/
├── data/
│   ├── sales_2023.xlsx      # 销售数据
│   ├── products.xlsx        # 产品信息
│   └── customers.xlsx       # 客户信息
└── results/
    └── analysis.xlsx        # 分析结果
```

### 2. 命名规范
- 文件名使用有意义的名称
- Sheet名称简洁明了
- 避免特殊字符和空格

### 3. 数据质量
- 确保数据格式一致
- 检查缺失值和异常值
- 统一日期和数值格式

### 4. 工作流程
1. 准备和整理数据文件
2. 按逻辑顺序选择文件和Sheet
3. 检查预览确认数据正确
4. 保存选择并切换到处理Tab
5. 完成后清理临时数据

通过遵循这些指南，您可以高效地使用多Excel多Sheet功能进行数据处理和分析。