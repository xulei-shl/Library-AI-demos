  ### 整体逻辑分析


  这个模块的核心目标是L2知识关联：它从一个Excel表格中已经存在的L1（结构化信息）和关键词
  中提取出实体（如人名、地名、作品名），然后利用Wikidata和Wikipedia等外部知识库对这些实
  体进行查询和消歧，最后将找到的权威链接（URI）写回到Excel表格的一个新列（L2知识关联JSO
  N）中。


  整个流程被清晰地划分为三个主要步骤，由 main.py 统一调度：


   1. Step 1: 构建任务清单 (Task 
      Building)：从Excel中读取数据，抽取出需要处理的、去重后的实体列表。
  
  ```mermaid
  graph TD
      subgraph 数据与配置
          A[metadata.xlsx]
          B[settings.yaml]
          C[src/prompts/*.md]
      end

      subgraph L2知识关联流程
          D[main.py: run_l2]
          E[task_builder.py: build_task_list]
          F[entity_processor.py: process_entities]
          G[result_writer.py: write_results]
      end

      subgraph 外部服务与输出
          H(LLM API)
          I[api_clients.py]
          J(Wikidata API)
          K(Wikipedia API)
          L[runtime/outputs/*.md]
      end

      %% 流程与数据流
      B -- 读取配置 --> D
      A -- 读取L1/关键词列 --> E
      D -- 调用 --> E
      E -- 生成 task_list --> F
      D -- 调用 --> F
      C -- 读取提示词 --> F
      F -- 调用 --> H
      F -- 调用 --> I
      I -- 查询 --> J
      I -- 查询 --> K
      F -- 写入全文 --> L
      F -- 生成 enriched_entities --> G
      D -- 调用 --> G
      G -- 更新L2列 --> A

      style A fill:#cde4ff,stroke:#333,stroke-width:2px
      style L fill:#fff2cc,stroke:#333,stroke-width:2px
  ```

  ### 各Python文件逻辑详解

  #### 1. main.py - 总调度器

   - 角色：整个L2知识关联流程的入口和总指挥。
   - 角色：负责从杂乱的原始数据中构建出干净、唯一的实体任务列表。
  3. entity_processor.py - 实体处理器 (Step 2)
   - 角色：执行最核心的知识关联任务，是整个流程中与AI和外部API交互最密集的部分。
   - 角色：封装了对Wikidata和Wikipedia API的调用，使 entity_processor 的逻辑更清晰。
   - 角色：负责将处理完成的实体信息安全、准确地写回到Excel中。
  这个模块设计良好，职责分离清晰：
  - main.py 是大脑，负责指挥。
  - task_builder.py 是数据清洗工，准备原料。
  - entity_processor.py 是核心车间，进行加工处理，并与
  api_clients.py（采购员）和LLM（技术专家）协作。
  - result_writer.py 是包装工，将成品放回仓库。


  这种模块化的结构使得每一部分的功能都高度内聚，易于单独测试和维护。