# 📚 书海回响 (Echoes of the Book Sea)

**每一本归还的图书，都是一次无声的推荐。我们倾听书海的回响，再发现那些沉淀下来的智慧遗珠。**

![](https://xulei-pic-1258542021.cos.ap-shanghai.myqcloud.com/mdpic/54121109456737.png)

![](https://xulei-pic-1258542021.cos.ap-shanghai.myqcloud.com/mdpic/54121109932369.png)

![](https://xulei-pic-1258542021.cos.ap-shanghai.myqcloud.com/mdpic/54121111133579.png)

![](https://xulei-pic-1258542021.cos.ap-shanghai.myqcloud.com/mdpic/54121109932369-S.png)

---

## 🎯 项目简介

书海回响是一个基于借阅数据分析与大模型评选的图书推荐系统。我们相信，真正的好书往往在热闹的借阅榜单之外。基于真实读者的归还数据，我们发现那些被时间沉淀但依然值得推荐的"遗珠"图书。

### 💡 核心理念
- **回归真实阅读**：以读者真实的借阅行为为数据源
- **发掘沉淀价值**：避开热门榜单，寻找品质上乘但热度已回落的图书
- **倡导深度思考**：推荐能提供精神滋养、认知提升的深度阅读
- **持续焕新**：每月推荐，确保内容常新

---

## 🏗️ 系统架构

### 📊 数据处理流程
```
借阅数据 → 数据清洗 → 借阅数据分析筛选 → 豆瓣评分分析筛选 → AI评选 → 社交卡片
```

### 🔄 五大功能模块

| 模块 | 名称 | 主要功能 | 输入 | 输出 |
|------|------|----------|------|------|
| **模块1** | 借阅数据分析 | 分析月归还数据，统计借阅频次 | 近三月借阅Excel | 借阅统计结果Excel |
| **模块2** | 智能筛选降噪 | 排除热门图书，保留长尾精品 | 模块1结果 | 筛选后数据Excel |
| **模块3** | 豆瓣信息获取 | 获取ISBN、评分、简介等信息 | 模块2结果 | 豆瓣详情数据Excel |
| **模块4** | 大模型评选 | AI三阶段评选 + 人工评选 | 模块3结果 | 评选结果Excel |
| **模块5** | 图书卡片生成 | 生成精美的社交分享卡片 | 模块4结果 | HTML卡片 + PNG图片 |

---

## 🚀 快速开始

### 📋 系统要求
- Python 3.8+
- Windows 10/11 系统
- 稳定的网络连接

### ⚙️ 安装步骤

#### 第一步：数据库初始化
```bash
# 创建数据库表结构
python src/tools/init_database.py
```

**📖 数据库说明**：系统会创建4张核心表：
- `books` - 书籍基础信息和豆瓣信息
- `borrow_records` - 借阅记录历史  
- `borrow_statistics` - 每月统计汇总
- `recommendation_results` - 书目推荐评选结果

#### 第二步：配置密钥文件
1. 复制配置模板：
   ```
   复制 config/.env.example 为 config/.env
   ```

2. 编辑 `config/.env` 文件，填入实际值：
   ```env
   # FOLIO系统登录凭据（用于获取ISBN）
   FOLIO_USERNAME=你的用户名
   FOLIO_PASSWORD=你的密码
   
   # 豆瓣账号（用于豆瓣评分获取）
   DOUBAN_USERNAME=你的豆瓣账号
   DOUBAN_PASSWORD=你的豆瓣密码
   
   # 可选：大模型监控服务
   LANGFUSE_SECRET_KEY=你的密钥
   ```

3. 修改主要配置（可选）：
   - 编辑 `config/setting.yaml` 调整筛选规则、评选标准等

#### 第三步：准备借阅数据
准备以下Excel文件（使用项目提供的模板）：

**📄 必需文件**：（可配置）
- `data/月归还.xlsx` - 当月归还数据
- `data/近三月借阅.xlsx` - 近三个月借阅历史

**📄 模板说明**：
项目在 `data/` 目录提供了模板文件，可以直接使用或参考格式：

- `近三月借阅 - 模板.xlsx`：包含19个列，涵盖读者信息、借阅记录、索书号等
- `月归还 - 模板.xlsx`：月度归还数据模板

#### 第四步：准备视觉资源（模块5必需）
**🎨 Logo和背景图片**：
- `data/logo/` 目录包含图书卡片生成所需的视觉资源
- 背景图片（b-1.png 到 b-30.png）
- Logo文件：`logo_shl.png`、`logozi_shl.jpg`


#### 第五步：运行系统
```bash
# 启动主程序
python main.py
```

---

## 🎮 使用方式

### 📋 运行模式选择

启动程序后，你会看到菜单选项：

```
请选择要运行的功能模块:
1. 模块1/2: 月归还数据分析 + 智能筛选
2. 模块3: 豆瓣模块（ISBN获取 + 豆瓣评分）
3. 数据采集流程: 模块1 -> 模块2 -> 模块3
4. 模块4: 初评（AI海选阶段）
5. 模块4: 完整评选（初评→决选→终评）
6. 数据分析与评选流程: 模块1 -> 模块2 -> 模块3 -> 模块4
7. 模块5: 图书卡片生成
8. 退出程序

请输入选择 (1-8):
```

---

## 📖 各模块详细说明

### 📊 模块1：借阅数据分析
**🎯 功能**：分析读者的借阅行为，统计每本书的借阅频次等

**🔧 处理步骤**：
1. 加载月归还数据和近三月借阅数据
2. 清洗数据，标准化格式
3. 计算每本书的借阅统计：
   - 近三个月总借阅次数
   - 各月分别借阅次数
   - 独立借阅读者数量

**📈 输出结果**：
- Excel文件：包含统计结果的详细数据
- 统计报告：借阅情况摘要和趋势分析

### 🔍 模块2：智能筛选降噪
**🎯 功能**：排除热门等图书，专注于发现被低估的好书

**📋 筛选规则**：

#### 规则A：排除顶流热门图书
- **逻辑**：使用分位数方法，排除借阅频次最高的前15%图书
- **效果**：避免畅销书对推荐结果的过度影响
- **备选**：支持固定阈值（≥20次）方式

#### 规则B：特定内容过滤
- **书名关键词**：排除"教程"、"考试"、"应试"等类型
- **索书号过滤**：排除漫画、期刊、参考工具书等
- **示例排除词**：不要、废书、损坏、散页

#### 规则C：数据质量验证
- **附加信息**：验证是否为9位数字格式
- **备注检查**：排除明显有问题的图书

#### 规则D：查重防重复推荐
- **数据库查重**：排除已入选的历史书目
- **智能防重复**：确保每月推荐内容的新鲜度

**📈 输出结果**：
- 筛选后的优质图书列表Excel
- 被过滤的图书详细清单
- 筛选规则执行报告

### 🌐 模块3：豆瓣信息获取
**🎯 功能**：获取图书的豆瓣评分、简介、封面等详细信息

**🔧 处理步骤**：
1. **ISBN获取**：从FOLIO系统获取图书ISBN号
2. **豆瓣链接**：在豆瓣搜索找到图书主页
3. **信息抓取**：获取评分、作者、简介、封面等
4. **数据验证**：过滤质量不达标的条目

**📋 获取信息**：
- **基础信息**：书名、作者、出版社、ISBN
- **评分数据**：豆瓣评分、评价人数
- **内容描述**：内容简介、作者简介、目录
- **视觉资源**：封面图片链接
- **其他信息**：定价、页数、装帧、出版年

**📈 输出结果**：
- 包含豆瓣详情的完整数据Excel
- 评分统计分析报告
- 数据质量验证报告

**⚡ 性能配置**：
- 支持并发处理（可调整）
- 智能重试机制
- 进度自动保存
- 历史数据查重

### 🤖 模块4：大模型评选
**🎯 功能**：AI三阶段评选机制，结合人工评选

**🏆 三阶段评选流程**：

#### 第一阶段：初评（海选）
- **目标**：从海量数据中筛选出有潜力的图书
- **标准**：内容质量、深度阅读价值、认知提升潜力
- **淘汰率**：约60-70%的图书

#### 第二阶段：主题内决选（晋级赛）
- **目标**：在同一主题内竞争，平衡各主题
- **方法**：按索书号分主题，每主题选择最优
- **效果**：确保最终推荐的多样性

#### 第三阶段：全局终评（决赛圈）
- **目标**：跨主题择优，选择整体最佳
- **策略**：智能模式选择，自适应评选策略
- **质量控制**：确保推荐书目的最高标准

**👤 人工评选**：
- **最终决策**：人工筛选最终入选书目
- **推荐语**：人工撰写推荐理由
- **质量保证**：人工审核确保推荐质量

**📈 评选结果字段**：
- **评分**：各阶段AI评分
- **理由**：详细评选理由
- **淘汰原因**：未通过原因说明
- **人工选择**：人工最终决定
- **推荐语**：人工推荐理由

### 🎨 模块5：图书卡片生成
**🎯 功能**：将入选图书生成精美的社交媒体分享卡片

**🎨 卡片内容**：
- **核心信息**：书名、作者、豆瓣评分
- **推荐理由**：精选的推荐语或评语
- **视觉元素**：豆瓣封面、图书馆Logo
- **功能模块**：索书号二维码（扫码查看馆藏）
- **设计风格**：现代简约、专业美观

**📱 输出格式**：
- **HTML卡片**：交互式网页版本
- **PNG图片**：适合社交媒体分享
- **批量生成**：支持一次生成多本图书

**🖼️ 视觉资源说明**：
- **Logo资源路径**：`data/logo/` 目录
- **包含文件**：30个编号Logo（b-1.png 到 b-30.png）、主Logo文件
- **用途**：图书卡片中显示图书馆品牌标识
- **自定义**：可在 `config/card_template.html` 中自定义配置

---

## ⚙️ 配置说明

### 📁 核心配置文件

#### `config/setting.yaml` - 主配置
**用途**：系统核心配置，控制所有模块的行为

**主要配置项**：
- **数据路径**：Excel文件位置、输出目录
- **筛选规则**：各模块的筛选标准和阈值
- **豆瓣配置**：爬取策略、API参数
- **评选标准**：AI评选的参数和策略
- **卡片样式**：图书卡片的生成参数

#### `config/.env` - 密钥配置
**用途**：存储敏感信息和第三方服务密钥

**必需配置**：
```env
# FOLIO系统登录（用于ISBN获取）
FOLIO_USERNAME=你的用户名
FOLIO_PASSWORD=你的密码

# 豆瓣账号（用于豆瓣信息获取）
DOUBAN_USERNAME=你的豆瓣账号
DOUBAN_PASSWORD=你的豆瓣密码
```

#### `config/filters/` - 过滤规则文件
**用途**：定义智能筛选的具体规则

**文件说明**：
- `title_keywords.txt` - 书名关键词过滤规则
- `call_number_clc.txt` - 索书号和分类过滤规则

### 📊 数据模板

#### Excel文件格式要求
**📄 必需字段**：
- 书目条码、索书号、书名
- 读者卡号、归还时间
- 附加信息、备注等

---

## 📂 输出文件说明

### 📊 数据文件
**📈 统计结果文件**：
- `月归还数据统计结果_YYYYMMDD_HHMMSS.xlsx` - 基础统计数据
- `月归还数据筛选结果_YYYYMMDD_HHMMSS.xlsx` - 智能筛选后数据
- `月归还数据筛选结果_YYYYMMDD_HHMMSS_豆瓣结果_YYYYMMDD_HHMMSS.xlsx` - 豆瓣详情数据

**📋 报告文件**：
- `月归还数据筛选报告_YYYYMMDD_HHMMSS.txt` - 筛选规则执行报告
- `月归还数据统计报告_YYYYMMDD_HHMMSS.txt` - 借阅统计摘要

**🗑️ 被过滤数据**：
- `被过滤数据_YYYYMMDD_HHMMSS.xlsx` - 被排除的图书清单

### 🎨 卡片生成文件
**📁 输出目录结构**：
```
runtime/outputs/
├── 图书卡片_YYYYMMDD_HHMMSS/
│   ├── 54121109456737.html  # 单本书HTML卡片
│   ├── 54121109456737.png   # 单本书PNG图片
└── card_generation_report_YYYYMMDD_HHMMSS.txt
```

**📸 卡片文件说明**：
- **HTML卡片**：可交互的网页版本，适合在线展示
- **PNG图片**：适合社交媒体分享的静态图片
- **二维码**：扫码可直接查看图书馆系统中的馆藏信息
- **封面图片**：下载的豆瓣图书封面图片


---

**让每一本好书都能被发现，让每一次阅读都充满意义。** 📚✨
