# 图书卡片HTML模板设计规范

## 📋 项目信息

**项目名称**：书海回响（Book Echoes）

**模板用途**：制作图书推荐卡片，用于批量生成图书宣传海报

## 📊 提供的文本与图片信息样例

```
- 书名：日本 : 文化核心日本
- 作者：[日] 松冈正刚
- 出版社：岳麓书社
- 出版年份：2023
- 评分（Rate）：7.6
- 索书号（Call Number）：G131.3/4971
- 推荐语：一位编辑泰斗对日本文化基因的冷静解剖。松冈正刚以其惊人的阅读量和独特的"编辑工学"视角，重新梳理了日本文化的底层代码。字字珠玑，直击"缩小"意识的核心，是理解东方美学的必读之作。
```

---

## ⚠️ 核心设计要求

### 1. 模板化设计原则

- **批量生成**：制作的是HTML模板，用于脚本传入图书信息批量出图
- **CSS独立定义**：图书元素的CSS要独立定义，便于后期微调
- **字体样式完整**：必须定义文本元素的字体、大小、颜色、间距等所有样式
- **固定资源路径**：图片路径与名称是固定的，不用改变

### 2. 文本自适应处理

**必须处理的文本字段**：题名、责任者、推荐语、出版社等

**处理方式**：
- 设计时要考虑自适应不同文本长度
- 超过容器宽度时可截断并用省略号显示
- 使用CSS实现文本截断（见下方技术规范）

### 3. 视觉设计要求

- **高级审美**：以高级排版与平面设计师的专业审美标准制作
- **品位与冲击力**：确保设计高级、有品位、有视觉冲击力

---

## 🎯 HTML模板截图兼容性规范（严格遵循）

### 一、主容器CSS类名规范 ⭐

**截图识别优先级（从高到低）**：

```html
<!-- 优先级1：最高优先级 -->
<div class="library-card">内容</div>     <!-- ⭐ 推荐使用 -->

<!-- 优先级2：图书卡片 -->
<div class="book-card">内容</div>

<!-- 优先级3：第一个div元素（备用） -->
<body><div>内容</div></body>

<!-- 优先级4：通用卡片类 -->
<div class="card">内容</div>

<!-- 优先级5：响应式类 -->
<div class="max-w-xxx">内容</div>

<!-- 优先级6：main标签 -->
<main>内容</main>
```

**✅ 推荐做法**：
- 新模板统一使用 `class="library-card"` 作为主容器类名
- 确保主容器是 `<body>` 下的第一个 `<div>` 元素

---

### 二、容器尺寸与布局规范 📏

#### 1. 容器尺寸建议

```css
.library-card {
    width: 600px;           /* 宽度：400-800px 之间 */
    /* 高度：自动计算，无需设置固定高度 */
}
```

**尺寸范围**：
- **宽度**：400-800px（推荐 600px）
- **高度**：自动计算，通常在 300-1200px 之间

#### 2. 底部空白处理 ⚠️ **关键要点**

**❌ 错误做法**：在主容器底部添加多余的边距

```css
/* ❌ 不要这样做 */
.library-card {
    padding-bottom: 20px;   /* 会导致底部多余空白 */
    margin-bottom: 20px;    /* 会导致底部多余空白 */
}
```

**✅ 正确做法**：让容器紧贴内容，不添加多余边距

```css
/* ✅ 推荐做法 */
.library-card {
    width: 600px;
    background-color: #fff;
    /* 不设置 padding-bottom 和 margin-bottom */
}
```

**如果底部有装饰区域**：

```css
/* ✅ 底部区域作为容器的最后一个子元素 */
.bottom-section {
    height: 240px;
    background-color: #333;
    /* 不设置 margin-bottom */
}
```

#### 3. DOM结构要求

```html
<body>
    <!-- ✅ 主容器必须是body下的第一个div -->
    <div class="library-card">
        <!-- 顶部区域 -->
        <div class="top-section">...</div>
        
        <!-- 中间内容区域 -->
        <div class="content-section">...</div>
        
        <!-- 底部区域（如果有） -->
        <div class="bottom-section">...</div>
    </div>
</body>
```

---

### 三、截图配置参数说明 🔧

**当前截图配置**（在 `config/setting.yaml` 中）：

```yaml
html_to_image:
  viewport_width: 1200      # 视窗宽度
  viewport_height: 1400     # 视窗高度（足够显示高度约1200px的卡片）
  device_scale_factor: 2    # 设备缩放因子（高清截图）
  clip_element: true        # 裁剪元素（精确截取卡片边界）
  wait_time: 1000          # 等待时间（确保图片加载完成）
```

**设计建议**：
- 卡片总高度建议控制在 **1200px 以内**
- 如果卡片高度超过 1200px，需要调整配置中的 `viewport_height`

---

---

### 五、文本截断处理规范 ✂️

#### 1. 单行文本截断

```css
/* 单行文本截断（书名、作者、出版社等） */
.book-title {
    white-space: nowrap;        /* 强制不换行 */
    overflow: hidden;           /* 隐藏溢出内容 */
    text-overflow: ellipsis;    /* 显示省略号 */
    max-width: 100%;            /* 限制最大宽度 */
}
```

**HTML示例**：

```html
<div class="meta-row">
    <span class="meta-key">Title</span>
    <span class="meta-val book-title">{{TITLE}}</span>
</div>
```

#### 2. 多行文本截断

```css
/* 多行文本截断（推荐语、简介等） */
.recommendation {
    display: -webkit-box;
    -webkit-box-orient: vertical;
    -webkit-line-clamp: 4;      /* 限制为4行 */
    overflow: hidden;
    text-overflow: ellipsis;
    line-height: 1.6;
}
```

**HTML示例**：

```html
<div class="recommendation">
    {{RECOMMENDATION}}
</div>
```

#### 3. Flex布局中的文本截断

```css
/* Flex容器中的文本截断 */
.meta-row {
    display: flex;
    align-items: baseline;
}

.meta-key {
    flex-shrink: 0;             /* 标签不压缩 */
    min-width: 85px;
}

.meta-val {
    flex: 1;                    /* 占据剩余空间 */
    min-width: 0;               /* ⚠️ 关键：允许Flex子项收缩 */
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}
```

---

### 六、CSS样式规范 🎨

#### 1. 字体定义

- 中文字体：汇文明朝体、又又意宋、润植家如印奏章楷、上图东观体

```css
:root {
    /* 系统字体 */
    --sys-font: 'Inter', sans-serif;
    
    /* 标题字体 */
    --title-font: "汇文明朝体", "HuiWen MingChao", serif;
    
    /* 正文字体 */
    --body-font: "又又意宋", "YouYi Song", serif;
    
    /* 装饰字体 */
    --deco-font: 'Codystar', cursive;
}
```

#### 2. 颜色定义

```css
:root {
    --bg-color: #fbfaf9;        /* 背景色 */
    --text-color: #423832;      /* 文本色 */
    --accent-color: #d9480f;    /* 强调色 */
    --dark-bg: #2b221b;         /* 深色背景 */
}
```

#### 3. 避免使用的CSS特性

**❌ 禁止使用**：
- 复杂的 CSS3 transform 动画
- JavaScript 异步加载图片
- 复杂的 min-height/max-height 组合
- position: fixed（可能影响边界计算）

**✅ 推荐使用**：
- 简单的 transition 过渡效果
- 适度的 box-shadow
- border-radius 圆角
- opacity 透明度

---

## ✅ 模板测试清单

在提交新模板前，请确认以下所有项目：

### 基础结构
- [ ] 主容器使用 `class="library-card"` 类名
- [ ] 主容器是 `<body>` 下的第一个 `<div>` 元素
- [ ] 容器宽度在 400-800px 之间（推荐 600px）
- [ ] 容器高度自动计算，总高度不超过 1200px

### 底部处理
- [ ] 主容器 **没有** 设置 `padding-bottom`
- [ ] 主容器 **没有** 设置 `margin-bottom`
- [ ] 底部区域（如果有）**没有** 设置 `margin-bottom`
- [ ] 底部内容完整显示，无截断现象

### 图片资源
- [ ] 所有图片都在 `pic/` 目录下
- [ ] 使用相对路径引用图片
- [ ] 图片添加了 `onerror` 错误处理
- [ ] 图片格式为 PNG/JPG/JPEG/GIF/WebP

### 文本处理
- [ ] 书名、作者、出版社等使用单行截断
- [ ] 推荐语使用多行截断（2-4行）
- [ ] Flex布局中的文本设置了 `min-width: 0`
- [ ] 所有文本元素都有完整的字体、大小、颜色定义

### CSS样式
- [ ] 使用CSS变量定义颜色和字体
- [ ] 没有使用复杂的 transform 动画
- [ ] 没有使用 JavaScript 异步加载图片
- [ ] 阴影效果适度，不影响边界识别

### 视觉效果
- [ ] 设计高级、有品位、有视觉冲击力
- [ ] 排版清晰、层次分明
- [ ] 颜色搭配和谐
- [ ] 字体选择合适

---

## 🔧 截图技术原理说明

### 智能选择器机制

截图转换器采用多级回退机制：
1. 首选 `.library-card` - 精确识别
2. 次选 `.book-card` - 图书卡片
3. 回退 `body > div:first-child` - 第一个div
4. 通用 `.card` - 通用卡片类
5. 兜底：全页截图

### 渲染等待机制

- **网络空闲**：等待页面网络请求完成
- **图片加载**：等待所有 `<img>` 标签和CSS背景图加载完成
- **渲染完成**：额外等待一帧确保DOM渲染稳定
- **超时保护**：设置超时防止无限等待

### 边界识别算法

- 使用 `bounding_box()` 方法精确获取元素边界
- 自动应用 `clip` 参数进行精确截图
- 圆角效果会在截图后自动应用（可配置）

### 底部内容处理策略

**关键原理**：
1. **高度计算**：浏览器根据CSS计算容器的实际高度，包括所有子元素
2. **边界框获取**：`bounding_box()` 返回包含所有内容的最小矩形边界
3. **截图裁剪**：使用获取的边界框进行精确裁剪

**为什么不能添加底部边距**：
- 如果主容器设置了 `padding-bottom` 或 `margin-bottom`，会导致截图中出现多余的空白区域
- 底部区域应该作为容器的最后一个子元素，紧贴容器底部

---

## 🚫 严格禁止事项

2. **禁止**使用绝对路径或网络图片路径
3. **禁止**使用 JavaScript 异步加载图片
4. **禁止**使用复杂的 CSS3 transform 动画
5. **禁止**在主容器前放置其他同级 div 元素
6. **禁止**在主容器底部添加 `padding-bottom` 或 `margin-bottom`
7. **禁止**在底部区域添加 `margin-bottom`


---

**遵循以上规则，截图功能将100%正确工作。所有新模板都将自动获得智能截图优化能力。**

请以高级排版与平面设计师的专业审美，参考图片风格与排版设计帮我制作。确保图片的设计高级，有品位，视觉冲击力。

---

请根据要求，对原始设计进行项目适应性修改