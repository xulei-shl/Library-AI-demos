# 文学数据过滤配置

# 输入配置
input:
  # Excel 文件路径列表（支持绝对路径和相对路径）
  excel_files:
    - "data/new/2025/shang"  # 目录路径，将扫描该目录下的所有Excel文件
    # - "data/LiteratureFM/文学数据.xlsx"  # 单个文件路径示例

  # 是否扫描目录中的Excel文件
  scan_directories: true

  # 必需的列名（用于验证输入文件）
  required_columns:
    - "索书号"  # 数据中索书号列名
    - "题名"   # 题名列名

# 过滤规则配置
filters:
  # 索书号规则文件路径（使用 literature_clc.txt 提取文学类CLC号）
  call_number_rules: "config/filters/literature_clc.txt"

  # 题名关键词规则文件路径（留空则不启用题名过滤）
  title_keywords_rules: ""

  # 字段映射（支持不同 Excel 的列名差异）
  field_mapping:
    call_number: "索书号"       # Excel 中的索书号列名
    title: "题名"              # Excel 中的题名列名

  # 空值处理策略
  null_handling:
    call_number: "filter"      # 索书号为空时：filter=过滤, keep=保留
    title: "filter"            # 题名为空时：filter=过滤, keep=保留

  # 过滤逻辑（OR=满足任一规则即过滤，AND=需同时满足）
  logic: "OR"

# 输出配置
output:
  # 输出目录（文学类数据筛选结果）
  output_dir: "runtime/outputs/literature_LiteratureFM_filtered"

  # 文件名模板
  filename_template:
    passed: "数据筛选结果_{timestamp}.xlsx"      # 符合条件的数据
    filtered: "被过滤数据_{timestamp}.xlsx"      # 被过滤的数据
    merged: "数据筛选结果_{timestamp}.xlsx"          # 合并后的总表
  
  # 是否添加过滤原因列
  add_filter_reason: true

  # 过滤原因列名
  filter_reason_column: "过滤原因"

  # 是否合并所有符合条件的数据
  merge_passed_data: true

  # 合并时是否添加来源文件列
  add_source_file_column: true
  source_file_column: "来源文件"

# 日志配置
logging:
  # 日志级别（DEBUG, INFO, WARNING, ERROR）
  level: "INFO"

  # 是否输出详细统计信息
  verbose_stats: true

  database:
    # 数据库文件路径
    db_path: "runtime/database/books_history.db"
    table: "books"

# LLM 打标配置（Phase 2）
llm_tagging:
  enabled: true  # 是否启用 LLM 打标功能

  # 限制处理的书目数量（用于测试，节省大模型调用费用）
  # 设为 0 或不配置则处理所有数据
  max_items: 0

  # 标签词表配置文件路径（必须配置）
  vocabulary_file: "config/literary_tags_vocabulary.yaml"

  # 过滤条件：筛选待打标的书目（所有条件为AND关系）
  filter_conditions:
    # 索书号前缀（留空或null则不过滤）
    call_no_prefix: "I"
    # 最低豆瓣评分（留空或null则不过滤）
    min_douban_rating: 7.3
    # 必填字段列表（留空或null则不过滤）
    required_fields:
      - douban_summary  # 必须有内容简介
      - douban_cover_image  # 必须有封面图片

  # 批处理配置
  batch_processing:
    # 每批处理数量
    batch_size: 10
    # 批次间延迟（秒）
    delay_between_batches: 2
    # 是否显示进度条
    show_progress: true

  # 重试策略
  retry_strategy:
    # 是否启用兜底重试（主流程结束后，对失败记录再次重试）
    fallback_retry_enabled: true
    # 兜底重试次数
    fallback_max_retries: 2
    # 兜底重试延迟（秒）
    fallback_delay: 5

  # Prompt配置
  prompt:
    # Langfuse提示词名称（优先使用）
    langfuse_name: "文学情境标签生成"
    # 本地兜底文件（Langfuse不可用时使用）
    fallback_file: "prompts/literary_tagging.md"

  # 输出配置
  output:
    # 是否导出打标结果到Excel
    export_to_excel: false
    # 输出目录
    output_dir: "runtime/outputs/literary_shelf"
    # 文件名模板
    filename_template: "文学标签结果_{timestamp}.xlsx"

# 文学策划主题生成配置（Phase 2.5）
theme_generation:
  # 是否启用主题生成功能
  enabled: true

  # 默认生成数量
  default_count: 5

  # 输出配置
  output:
    # 输出目录
    output_dir: "runtime/outputs/theme_shelf"
    # 文件名模板
    filename_template: "themes_{timestamp}_{direction}.json"

# 候选图书 LLM 筛选配置（Phase 3.5）
candidate_filter:
  # 是否启用候选筛选功能
  enabled: true

  # 排除的 sheet 名称（不处理的sheet）
  excluded_sheets:
    - "主题汇总"
    - "元信息"

  # 分组配置
  grouping:
    # 每组图书数量（约30条数据分5组）
    group_size: 6
    # 是否随机打乱后分组
    shuffle: true
    # 随机种子（留空则随机）
    random_seed: null

  # Excel 字段映射
  excel_fields:
    # 主题汇总 sheet 的字段映射
    theme_summary:
      theme_name: "主题名称"
      slogan: "副标题"
      description: "情境描述"
      target_vibe: "预期氛围"
    # 候选图书 sheet 的字段列表（提取这些字段给 LLM）
    book_fields:
      - "douban_title"
      - "douban_subtitle"
      - "douban_author"
      - "douban_summary"
      - "douban_author_intro"
      - "douban_catalog"

  # LLM 调用配置
  llm:
    # 任务名称（对应 llm.yaml 中的任务名）
    task_name: "literary_reranking"
    # 并发调用数（同时处理多少组）
    concurrent_groups: 1

# 卷首导读生成配置（Phase 3.6）
prologue_generator:
  # 是否启用卷首导读生成功能
  enabled: true

  # 排除的 sheet 名称（不处理的sheet）
  excluded_sheets:
    - "主题汇总"
    - "元信息"

  # 人工评选列配置
  approval_column: "人工评选"  # 评选列名
  approval_value: "通过"        # 通过的值

  # Excel 字段映射
  excel_fields:
    # 主题汇总 sheet 的字段映射
    theme_summary:
      theme_name: "主题名称"
      slogan: "副标题"
      description: "情境描述"
      target_vibe: "预期氛围"
    # 参考图书 sheet 的字段列表（提取这些字段给 LLM）
    book_fields:
      - "douban_title"
      - "douban_subtitle"
      - "douban_author"
      - "douban_summary"
      - "douban_author_intro"
      - "douban_catalog"

  # LLM 调用配置
  llm:
    # 任务名称（对应 llm.yaml 中的任务名）
    task_name: "literary_writer"
