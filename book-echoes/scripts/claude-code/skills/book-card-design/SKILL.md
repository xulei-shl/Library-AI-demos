---
name: 图书卡片设计
description: |
  设计图书卡片 HTML 模板，支持复刻设计参考、迭代调整、模板化改造和验证测试。
  当用户提到：设计卡片、制作卡片模板、复刻卡片、卡片排版、图书卡片、library card、card template
  或需要将图片/HTML 转换为可批量生成的模板时自动使用此工作流。
  支持有/无封面图片两种场景，参考极简工业档案、绿色大字、默认等模板风格。
---

# 图书卡片设计工作流

将图书元数据（题名、作者、出版社、推荐语等）制作成可批量生成的 HTML 卡片模板。

## 快速开始

可以通过以下方式启动：
- 输入 `/book-card-design`
- 或直接说："帮我设计一个图书卡片"、"复刻这个卡片设计"、"制作卡片模板"

---

## 工作流程总览

| 步骤 | 名称 | 执行方式 | 输出位置 |
|------|------|----------|----------|
| Step 1 | 复刻排版 | **Subagent** `card-replicator` | `reproduction/{名称}.html` |
| Step 2 | 迭代调整 | **Subagent** `card-iterator` | `reproduction/{名称}.html` |
| Step 3 | 模板化改造 | 主对话执行 | `templates/{名称}.html` |
| Step 4 | 验证测试 | 主对话执行 | `tests/{名称}-测试-*.html` |
| Step 5 | 自动部署 | 主对话执行 | `F:\Github\Library-AI-demos\book-echoes\config\temples\{名称}.html` |

---

## Step 1: 复刻排版 📋

使用 **card-replicator** subagent 完成复刻工作。

### 何时使用

当用户需要：
- 开始新的卡片设计
- 根据设计参考（图片/HTML）创建卡片

### 调用方式

```
使用 card-replicator subagent 来复刻这个设计
```

### Subagent 职责

- 分析设计参考（图片或 HTML）
- 在 `reproduction/` 目录创建 `{名称}.html`
- 生成精确的 HTML/CSS 复刻代码
- 使用真实示例数据（非占位符）
- 每个元素独立 CSS（便于后期微调）

### 等待确认

⚠️ Subagent 完成后，**必须等待用户确认**：
- 用户在浏览器中查看复刻效果
- 提出调整要求
- 如需调整，进入 Step 2

---

## Step 2: 迭代调整 🎨

使用 **card-iterator** subagent 完成调整工作。

### 何时使用

当用户对复刻版有调整需求：
- 字体大小不合适
- 颜色需要调整
- 间距/边距需要微调
- 布局结构需要修改

### 调用方式

```
使用 card-iterator subagent 调整 reproduction/{名称}.html
```

### Subagent 职责

- 读取 `reproduction/{名称}.html`
- 根据用户反馈精确修改 CSS
- 每次调整后等待用户确认
- 支持多轮迭代直到用户满意

### 可调整内容

- **a) 字体大小**：标题、作者、推荐语等
- **b) 颜色搭配**：文字色、背景色、边框色
- **c) 间距/边距**：padding、margin、gap
- **d) 布局结构**：元素位置、排列方式
- **e) 其他**：圆角、阴影等

### 等待确认

⚠️ 每次调整后等待用户确认，满意后进入 Step 3。

---

## Step 3: 模板化改造 🔧

⚠️ **前提**：Step 1 和 Step 2 的复刻版本已确认无误

**在主对话中执行**，将复刻版改造成可批量出图的正式模板。

### 核心原则

✅ **现在开始需要遵循模板规则**：
- 文本自适应（截断处理）
- 批量出图规范
- 移除底部边距
- 规范图片路径

### 分支选择

根据是否有封面图片，参考不同规范：

| 场景 | 参考文档 |
|------|----------|
| 有封面图片 | @references/with-image.md |
| 无封面图片 | @references/without-image.md |

### 核心改造点

1. **添加主容器类名**：`<div class="library-card">`
2. **实现文本自适应**：
   - 单行截断：书名、作者、出版社
   - 多行截断：推荐语（3-4行）
3. **移除底部边距**：禁止 `padding-bottom` / `margin-bottom`
4. **规范图片路径**：`pic/cover.jpg`、`pic/qrcode.png` 等

### 占位符列表

```
{{TITLE}}           - 书名
{{AUTHOR}}          - 作者
{{PUBLISHER}}       - 出版社
{{PUB_YEAR}}        - 出版年份
{{RECOMMENDATION}}  - 推荐语
{{CALL_NUMBER}}     - 索书号
{{DOUBAN_RATING}}   - 豆瓣评分
```

---

## Step 4: 验证测试 ✅

⚠️ **前提**：Step 3 模板化改造已完成

**自动执行**：完成 Step 3 后，立即执行本步骤，生成两个测试文件验证模板的正确性。

### 测试要求

必须生成两个测试 HTML 文件，验证模板在不同文本长度下的适应性。

### 测试文件 1：标准短文本测试

**文件命名**：`{模板名称}-测试-标准短文本.html`

**测试数据**：使用真实的短文本数据填充

```yaml
- 书名：日本 : 文化核心日本
- 作者：[日] 松冈正刚
- 出版社：岳麓书社
- 出版年份：2023
- 评分：7.6
- 索书号：G131.3/4971
- 推荐语：一位编辑泰斗对日本文化基因的冷静解剖。松冈正刚以其惊人的阅读量和独特的"编辑工学"视角，重新梳理了日本文化的底层代码。字字珠玑，直击"缩小"意识的核心，是理解东方美学的必读之作。
```

### 测试文件 2：长文本极限测试

**文件命名**：`{模板名称}-测试-长文本极限.html`

**测试数据**：使用极端长文本数据，测试截断功能

```yaml
- 书名：这是非常非常长的书名测试用例用于验证单行文本截断功能是否正常工作超出部分应该显示省略号
- 作者：[作者名很长很长] [第二作者名也很长] [第三作者] [第四作者] [还有更多作者] [合著]
- 出版社：中华人民共和国出版总署下属 longest 出版社名称测试版本
- 出版年份：2023年12月31日版本超长年份测试
- 评分：9.9/10.0满分推荐豆瓣评分超长测试
- 索书号：G131.3/4971-EXTREMELY-LONG-CALL-NUMBER-TEST-VERSION-FOR-TRUNCATION
- 推荐语：这是一段非常非常长的推荐语测试用例，用于验证多行文本截断功能是否正常工作。第一行内容会正常显示，第二行内容也会正常显示，第三行内容是最后一行完整显示的内容，第四行开始应该会被截断并显示省略号，因为推荐语区域设置了最多显示三行的限制。
```

### 验证清单

用户需在浏览器中打开两个测试文件，确认以下项目：

#### 标准短文本测试
- [ ] 书名、作者正常显示（无截断）
- [ ] 元数据（出版社、年份、评分、索书号）正常显示
- [ ] 推荐语完整显示（不触发截断）

#### 长文本极限测试
- [ ] 书名显示省略号（单行截断生效）
- [ ] 作者显示省略号（单行截断生效）
- [ ] 所有元数据字段显示省略号（单行截断生效，不溢出卡片）
- [ ] 推荐语截断为3行并显示省略号（多行截断生效）
- [ ] 批量出图边界正确（无内容溢出卡片边界）
- [ ] 底部无多余空白

### 输出产物

```
project/
├── {模板名称}.html              # 正式模板（Step 3 输出）
├── {模板名称}-测试-标准短文本.html   # 测试文件 1
└── {模板名称}-测试-长文本极限.html   # 测试文件 2
```

### 等待确认

生成两个测试文件后，**必须等待用户确认**：
- 用户在浏览器中打开测试文件
- 用户报告验证结果
- 如有问题，修复模板后重新生成测试文件
- **验证通过后，自动部署到模板库**

### 自动部署

⚠️ **用户确认验证通过后**，自动执行部署：

1. 将最终模板移动到模板库：
   ```
   源文件：templates/{模板名称}.html
   目标路径：F:\Github\Library-AI-demos\book-echoes\config\temples\{模板名称}.html
   ```

2. 部署成功后报告：
   ```
   ✅ 模板已部署到模板库

   模板文件：F:\Github\Library-AI-demos\book-echoes\config\temples\{模板名称}.html
   ```

3. 工作流完成

---

## Step 5: 自动部署 🚀

⚠️ **前提**：Step 4 验证测试通过，用户确认无误

**自动执行**：将最终模板移动到模板库目录。

### 部署操作

**Windows 系统**：
```powershell
Move-Item templates/{模板名称}.html "F:\Github\Library-AI-demos\book-echoes\config\temples\{模板名称}.html"
```

### 部署完成报告

```
✅ 工作流完成！

最终模板已部署：
📁 F:\Github\Library-AI-demos\book-echoes\config\temples\{模板名称}.html

项目文件保留在：
📂 reproduction/  - 复刻版本
📂 templates/     - 本地模板副本
📂 tests/         - 测试文件
```

---

## 输出产物

```
project/
├── reproduction/                      # 复刻阶段（Step 1-2）
│   └── {卡片名称}.html
├── templates/                         # 正式模板（Step 3）
│   └── {卡片名称}.html
├── tests/                             # 测试文件（Step 4）
│   └── {卡片名称}-测试-标准短文本.html     # 测试文件 1
│   └── {卡片名称}-测试-标准长文本.html     # 测试文件 2

```

---

## Subagent 调用指南

### Step 1 - 调用 card-replicator

```
使用 card-replicator subagent 来复刻 [设计参考描述/路径]
```

### Step 2 - 调用 card-iterator

```
使用 card-iterator subagent 来调整 reproduction/{名称}.html
调整内容：[具体调整需求]
```

### Resume 调整

如果需要继续之前的调整工作：

```
继续之前的 card-iterator 调整工作
```

---

## 注意事项

1. **Subagent 隔离**：Step 1 和 Step 2 在独立上下文中执行，大量代码输出不会污染主对话
2. **Resume 支持**：Step 2 可以 resume 继续之前的调整会话
3. **每个文本元素独立 CSS**：便于后期手动微调
4. **文本长度自适应**：确保批量出图时不同图书都能正常显示
5. **遵循截图规范**：见 @references/template-spec.md
6. **Grid 布局子项收缩**：元数据区域的 Grid 子项必须设置 `min-width: 0`，否则长文本会溢出
