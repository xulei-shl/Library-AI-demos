# 开发变更记录
- **日期**: 2025-12-16
- **对应设计文档**: [图书检索API设计](../API接口模块/图书检索API设计.md)

## 1. 变更摘要
- 在 `scripts/api` 下新增 FastAPI 应用，提供文本检索与多子查询检索端点，符合 plain_text/llm_hint 约束。
- 实现 `RetrieverService` 封装，复用既有 `BookRetriever`、`OutputFormatter`、`build_query_package_from_md`，并支持临时 Markdown 文件、落盘开关与纯文本模板。
- 补充 `fastapi`/`uvicorn` 依赖以及单元测试，确保 API 路由与服务逻辑可被稳定复用。

## 2. 文件清单
- `scripts/api/book_retrieval_api.py`: **新增** FastAPI 应用与请求模型。
- `scripts/api/services/retriever_service.py`: **新增** 服务封装与临时文件处理。
- `scripts/api/__init__.py`, `scripts/api/services/__init__.py`: **新增** 模块初始化。
- `requirements.txt`: **修改** 新增 FastAPI/uvicorn 依赖。
- `tests/test_book_vectorization/test_retriever_service.py`: **新增** 服务层单元测试 2 项。
- `tests/test_book_vectorization/test_book_retrieval_api.py`: **新增** 路由测试 3 项。

## 3. 测试结果
- [x] `pytest tests/test_book_vectorization/test_retriever_service.py tests/test_book_vectorization/test_book_retrieval_api.py`
- [ ] 核心路径验证通过

