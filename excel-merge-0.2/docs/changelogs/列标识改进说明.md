# 列标识改进说明

## 问题描述

当前 `src/config/settings.py` 中 `COLUMN_MAPPINGS` 的配置方式存在以下挑战：
*   **冗余配置：** `"*"` 下的很多映射是 `“列名”: “列名”` 这种形式，在源列名与目标列名一致时显得冗余。
*   **维护成本：** 当源文件的列名发生少量变化时，即使大部分列名保持不变，也需要手动更新 `settings.py` 中的所有相关映射。

用户希望实现一种“默认复制”的逻辑，即如果源文件和目标文件的列名相同，则无需显式配置，系统能自动将其复制过去，只有当列名需要转换或有别名时才进行特殊配置。

## 建议的改进逻辑

可以在实际执行列映射的逻辑层（例如 `src/core/data_merger.py` 或 `src/processors/base_processor.py` 中处理列映射的方法）中引入一个智能的映射策略。

### 1. 默认直通逻辑

*   在处理每个源文件的列时，首先检查源列名是否与目标列名（或标准列名）完全一致。
*   如果一致，则直接将该列的数据复制到目标列，无需查找 `COLUMN_MAPPINGS`。这可以作为最高优先级的映射规则。

### 2. 配置优先逻辑

*   如果源列名与目标列名不一致，或者您希望对某个同名列进行特殊处理（例如，即使列名相同，也想强制应用某个转换），则继续查找 `COLUMN_MAPPINGS`。
*   `COLUMN_MAPPINGS` 中的配置应该具有更高的优先级，它会覆盖默认的直通逻辑。这意味着，如果 `settings.py` 中明确配置了 `“旧列名”: “新列名”`，即使 `旧列名` 和 `新列名` 相同，也会按照配置来处理（这在未来可能需要对同名列进行数据清洗或格式化时会很有用）。

### 3. 别名处理

*   在查找 `COLUMN_MAPPINGS` 时，可以先查找特定文件类型的映射（如 `yibu`、`erbu`、`sanbu`），如果找到则使用。
*   如果特定文件类型中没有找到，再查找全局的 `"*"` 映射，以处理别名（如 `“统计员”: “统计人”`）。

### 实现概念（伪代码示例）

```python
# 假设在某个处理列映射的函数中
def map_columns(source_df, file_type_specific_mappings, global_mappings):
    mapped_columns = {}
    for source_col in source_df.columns:
        target_col = None

        # 1. 尝试特定文件类型的映射
        if file_type_specific_mappings and source_col in file_type_specific_mappings:
            target_col = file_type_specific_mappings[source_col]
        # 2. 尝试全局映射（别名）
        elif global_mappings and source_col in global_mappings:
            target_col = global_mappings[source_col]
        # 3. 默认直通逻辑：如果源列名与目标列名相同，则直接使用
        else:
            target_col = source_col # 假设源列名就是目标列名

        mapped_columns[source_col] = target_col
    return mapped_columns
```

## 这种方法的优势

*   **简化配置：** `settings.py` 中的 `COLUMN_MAPPINGS` 可以只保留那些需要转换或有别名的列，大大减少了 `"*"` 部分的配置量。
*   **提高可维护性：** 当源文件列名发生微小变化时，如果新旧列名一致，则无需修改配置。
*   **增强灵活性：** 仍然可以通过配置来覆盖默认行为，处理特殊情况。
*   **清晰的意图：** 配置中只包含“例外”情况，使得配置文件的意图更加清晰。

## 潜在考虑

*   **标准列名定义：** 您可能需要一个明确的“标准列名”列表，以便在默认直通逻辑中进行比对，确保源列名确实是您期望的标准列名之一，而不是一个完全不相关的列。
*   **优先级管理：** 确保您的映射逻辑中，配置的优先级高于默认直通逻辑，以避免意外行为。

通过在代码中实现这种智能的列映射策略，您可以显著优化 `settings.py` 的配置，使其更加简洁和高效。
