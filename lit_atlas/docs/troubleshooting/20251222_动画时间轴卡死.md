# 故障复盘报告
- **日期**: 2025-12-22
- **严重级别**: Medium

## 1. 问题现象
地图只显示北京一个静态点，所有路线与涟漪动效均不触发。控制台无限刷 [InkLayer] Rendering frame … currentTime: 0，表明动画时间轴始终停留在 0ms。

## 2. 根本原因 (Root Cause)
播放控制逻辑依赖 usePlaybackStore，默认状态是暂停。虽然 UI 中的播放按钮已被移除，但 Map 组件仍然等待外部播放状态改变，于是 AnimationController 永远停在 0ms，从而导致除第一个城市外的全部 Feature 处于 HIDDEN 状态。

## 3. 解决方案
- 为 AnimationController 新增 syncWithFrameTime/esetTimeline，并在墨迹层的 postrender 钩子里直接使用 OpenLayers 的帧时间推进时间轴。
- Map 页面移除 usePlaybackStore 依赖，加载作者数据时立即注册 Feature 并重置时间轴，动画由帧渲染自动驱动，无需播放按钮。

## 4. 预防措施
- 当移除某个交互控件（如播放按钮）时，必须同步清理底层依赖，避免残留状态机阻塞逻辑。
- 在浏览器控制台加入基于 AnimationState 的断言，一旦所有 Feature 长时间处于 HIDDEN 应输出告警日志。
- 为 AnimationController 增加单元测试覆盖“默认暂停/无播放事件”场景，确保时间轴仍可由渲染帧驱动。
