# ✅ LLM模块接入检查清单

## 📦 环境准备

- [ ] 1. 将 `llm_api` 模块复制到项目目录
- [ ] 2. 安装依赖：`pip install openai PyYAML`
- [ ] 3. （可选）安装监控：`pip install langfuse`
- [ ] 4. Python版本 ≥ 3.7

## 🔑 API密钥配置

### 方式一：.env 文件（推荐）

- [ ] 1. 在项目根目录创建 `.env` 文件
- [ ] 2. 添加至少一个文本提供商密钥：
  ```bash
  # 示例：DeepSeek
  DEEPSEEK_API_KEY=sk-your-key-here

  # 或 Groq
  GROQ_API_KEY=gsk-your-key-here

  # 或 ModelScope
  MODELSCOPE_API_KEY=your-key-here
  ```
- [ ] 3. （可选）配置备用提供商密钥
- [ ] 4. （可选）配置视觉提供商密钥
- [ ] 5. （可选）配置 Langfuse 监控密钥

### 方式二：环境变量

- [ ] 1. 在系统中设置环境变量：
  ```bash
  export DEEPSEEK_API_KEY=sk-your-key-here
  ```
- [ ] 2. 或在代码中设置：
  ```python
  import os
  os.environ["DEEPSEEK_API_KEY"] = "sk-your-key-here"
  ```

## ⚙️ 配置文件

- [ ] 1. 复制 `config/settings.yaml` 到您的项目
- [ ] 2. 修改 `api_providers.text.primary.api_key` 为您的密钥变量名
- [ ] 3. 修改 `base_url` 为正确的API地址
- [ ] 4. 修改 `model` 为可用的模型名称
- [ ] 5. 检查配置文件格式正确（YAML语法）

### 常用API配置参考

**DeepSeek:**
```yaml
api_key: env:DEEPSEEK_API_KEY
base_url: "https://api.deepseek.com/v1"
model: "deepseek-chat"
```

**Groq:**
```yaml
api_key: env:GROQ_API_KEY
base_url: "https://api.groq.com/openai/v1"
model: "mixtral-8x7b-32768"
```

**ModelScope:**
```yaml
api_key: env:MODELSCOPE_API_KEY
base_url: "https://api-inference.modelscope.cn/v1"
model: "deepseek-ai/DeepSeek-V3.2-Exp"
```

## 📝 提示词文件

- [ ] 1. 复制 `prompts/` 目录到您的项目
- [ ] 2. 或创建自定义提示词文件
- [ ] 3. 在配置中指定正确的文件路径
- [ ] 4. 提示词文件可正常读取

## 🚀 代码集成

### 基础调用测试

- [ ] 1. 创建客户端实例
  ```python
  from llm_api.core.llm_client import UnifiedLLMClient
  client = UnifiedLLMClient("path/to/config.yaml")
  ```
- [ ] 2. 执行简单调用测试
  ```python
  result = await client.call(
      task_name="correction",
      user_prompt="这是一个测试文本"
  )
  print(result)
  ```
- [ ] 3. 关闭客户端
  ```python
  await client.close()
  ```

### 高级功能测试

- [ ] 4. 测试流式调用
  ```python
  async for chunk in client.stream_call(...):
      print(chunk, end="")
  ```

- [ ] 5. 测试批量调用
  ```python
  results = await client.batch_call(requests, max_concurrent=5)
  ```

- [ ] 6. 测试任务列表
  ```python
  tasks = client.list_tasks()
  print(tasks)
  ```

- [ ] 7. 测试错误处理
  ```python
  try:
      result = await client.call(...)
  except Exception as e:
      print(f"错误: {e}")
  ```

## 🔍 功能验证

### 文本任务

- [ ] 1. 文本校对任务 (`correction`) 正常工作
- [ ] 2. 能够返回正确的校对结果
- [ ] 3. 自定义任务（如果有）正常工作

### 视觉任务

- [ ] 1. 图像描述任务 (`fact_description`) 正常工作
- [ ] 2. 能够返回结构化的描述结果
- [ ] 3. JSON格式正确（如果启用）

### 系统功能

- [ ] 1. 重试机制正常工作
- [ ] 2. Provider切换正常工作（如果配置了备用）
- [ ] 3. 日志记录正常工作
- [ ] 4. 速率限制正常工作

## 🐛 问题排查

### 配置文件问题

- [ ] 1. 配置文件路径正确
- [ ] 2. YAML格式正确（无缩进错误）
- [ ] 3. 必需字段都已填写

### API密钥问题

- [ ] 1. 密钥变量名正确
- [ ] 2. 密钥有效且有权限
- [ ] 3. 环境变量已加载
- [ ] 4. 密钥有足够的使用额度

### 网络问题

- [ ] 1. 网络连接正常
- [ ] 2. 能访问API地址
- [ ] 3. 没有代理冲突
- [ ] 4. 超时时间设置合理

### 模型问题

- [ ] 1. 模型名称正确
- [ ] 2. 模型支持您使用的API
- [ ] 3. 模型未过期或下线

## 📊 性能优化

- [ ] 1. 合理设置 `max_concurrent`（建议 5-10）
- [ ] 2. 复用客户端实例（不要每次调用都创建）
- [ ] 3. 使用批量调用处理多任务
- [ ] 4. 合理设置超时时间
- [ ] 5. 配置速率限制避免被限流

## 🔐 安全检查

- [ ] 1. API密钥未提交到代码仓库
- [ ] 2. 使用 `.env` 文件或环境变量存储密钥
- [ ] 3. `.env` 已添加到 `.gitignore`
- [ ] 4. 生产环境使用独立的API密钥
- [ ] 5. 定期轮换API密钥

## 📚 文档查看

- [ ] 1. 查看 `项目接入指南.md` 了解详细用法
- [ ] 2. 查看 `examples/` 目录的示例代码
- [ ] 3. 查看 `README.md` 了解完整功能
- [ ] 4. 保存相关链接便于后续查阅

## ✅ 完成确认

在开始使用前，请确认：

- [ ] 所有基础测试通过
- [ ] API密钥配置正确
- [ ] 配置文件格式正确
- [ ] 至少一个任务可以正常调用
- [ ] 错误处理机制已实现

---

## 🚨 常见错误快速对照

| 错误信息 | 可能原因 | 解决方案 |
|---------|---------|---------|
| `配置文件不存在` | 路径错误 | 检查配置文件路径 |
| `missing_env_key` | 环境变量未设置 | 检查 .env 文件和环境变量 |
| `连接超时` | 网络问题或超时设置过短 | 检查网络，增加超时时间 |
| `模型不存在` | 模型名称错误 | 检查模型名称拼写 |
| `认证失败` | API密钥错误 | 检查密钥是否正确 |
| `速率限制` | 请求过于频繁 | 使用批量调用和限流 |

---

## 📞 获取帮助

如果遇到问题：

1. **查看日志**: 启用 DEBUG 级别的日志查看详细错误
2. **查看错误历史**: `LLMCallError.error_history`
3. **查看文档**: `项目接入指南.md`
4. **运行测试**: `python quick_start_template.py`
5. **提交 Issue**: 在项目仓库提交问题

---

**🎉 检查完成后，您就可以开始使用统一LLM调用系统了！**
