# Book Echoes 首页设计方案

## 设计理念:杂志封面式布局

采用**最新期突出 + 年份归档**的双层结构,既能吸引访客关注最新内容,又能优雅地组织历史数据。

---

## 页面结构

```
┌─────────────────────────────────────────────────┐
│  📚 Book Echoes Header                          │
├─────────────────────────────────────────────────┤
│                                                 │
│           [最新3期扇形卡片展示区]                │
│                                                 │
│      ┌────┐   ╔═══════════╗   ┌────┐          │
│      │ 7月 │   ║   9月(新)  ║   │ 8月 │          │
│      │小卡 │   ║   大卡片   ║   │小卡 │          │
│      │倾斜 │   ║  3:4 比例  ║   │倾斜 │          │
│      └────┘   ║           ║   └────┘          │
│               ╚═══════════╝                    │
│                                                 │
│  ──────────── 往期回顾 ────────────             │
│                                                 │
│  年份: [2025] [2024] [2023] ...                 │
│                                                 │
│  ┌────┐ ┌────┐ ┌────┐ ┌────┐                   │
│  │ 6月 │ │ 5月 │ │ 4月 │ │ 3月 │                   │
│  └────┘ └────┘ └────┘ └────┘                   │
│  ┌────┐ ┌────┐                                 │
│  │ 2月 │ │ 1月 │                                 │
│  └────┘ └────┘                                 │
│                                                 │
│  2025 年共 9 期 · 总计 108 本书                  │
└─────────────────────────────────────────────────┘
```

**注**: 最新3期展示区会根据数据量自动适配:
- 1期: 单张大卡片居中
- 2期: 两张并排卡片
- 3期: 扇形三卡片布局(中间大,两侧小)

---

## 核心组件

### 1. MagazineCover.tsx
**功能**: 智能展示最新1-3期的封面,根据数据量自动切换布局

**自适应布局策略**:

#### 单卡片模式(1期数据)
- 3:4 纵向比例,居中展示
- 使用第一本书的缩略图作为背景
- 渐变遮罩确保文字可读性
- 简洁的 Hover 缩放效果

#### 双卡片模式(2期数据)
- 两张卡片并排网格布局
- 3D 鼠标跟随效果(根据鼠标位置倾斜)
- Hover 时放大 1.05 倍并置顶
- 最新期标注"最新期"标签

#### 三卡片模式(3期数据) - **高级动效**
- **扇形布局**: 左右卡片向两侧倾斜±8°,中间最新期放大 1.2 倍
- **3D透视**: 整个容器启用 `perspective: 1500px`
- **鼠标跟随**: 移动鼠标时卡片动态倾斜±10°(`rotateX`/`rotateY`)
- **深度模糊**: 非焦点卡片轻微模糊 1px,营造景深
- **光效渐变**: Hover 时出现白色光晕(`from-white/10`)
- **阴影层次**: 3D 阴影投射到 `translateZ(-50px)` 平面
- **弹簧动画**: 依次飞入效果(延迟 0.15s,弹性系数 100)

**交互逻辑**:
```typescript
// 鼠标位置追踪
const mouseX = useMotionValue(0);
const mouseY = useMotionValue(0);
const rotateX = useTransform(mouseY, [-300, 300], [10, -10]);
const rotateY = useTransform(mouseX, [-300, 300], [-10, 10]);

// 卡片位置计算
if (index === 0) return { scale: 1.2, rotate: 0, zIndex: 3 }; // 中间
if (index === 1) return { scale: 0.85, rotate: -8, zIndex: 1, x: -20 }; // 左侧
if (index === 2) return { scale: 0.85, rotate: 8, zIndex: 1, x: 20 }; // 右侧
```

**数据接口**:
```typescript
interface MagazineCoverProps {
  latestMonths: Month[]; // 接收最新1-3期的数组
}
```

**性能优化**:
- 仅渲染最新3期,其余进入归档区
- 使用 `useTransform` 避免重复计算
- 图片懒加载和尺寸优化

---

### 2. ArchiveTimeline.tsx
**功能**: 按年份归档展示历史期刊

**特点**:
- 自动按年份分组(从 `2025-09` 提取 `2025`)
- 年份切换器(支持 URL 参数 `?year=2024`)
- 响应式网格布局(2/3/4 列)
- 懒加载友好(仅渲染当前年份)

**年份切换逻辑**:
```typescript
// URL: /?year=2024
const searchParams = useSearchParams();
const urlYear = searchParams?.get('year');

// 切换年份时更新 URL(不滚动)
router.push(`/?year=${year}`, { scroll: false });
```

---

## 数据流设计

### 自动化数据读取
所有数据来自 `content/` 文件夹,无需手动配置:

```
public/content/
├── 2025-09/
│   ├── metadata.json      # 书籍列表
│   └── {书目条码}/
│       └── {书目条码}_thumb.jpg
├── 2025-10/
├── 2026-01/              # 自动识别新年份
└── ...
```

### getMonths() 函数
位于 [app/page.tsx](app/page.tsx:7-56)

**功能**:
1. 扫描 `content/` 下所有文件夹
2. 自动解析年月(如 `2025-09`)
3. 读取 `metadata.json` 获取书籍数量
4. 提取第一本书的缩略图
5. 按时间倒序排列

**关键代码**:
```typescript
const months = entries
  .filter(entry => entry.isDirectory() && !entry.name.startsWith('.'))
  .map(entry => entry.name)
  .sort((a, b) => b.localeCompare(a)); // 最新在前

// Vol 编号自动计算
vol: `Vol. ${months.length - index}`
```

**首页数据分配**:
```typescript
const latestMonths = months.slice(0, 3); // 最新3期用于 MagazineCover
const archiveMonths = months.slice(3);   // 其余期刊归档到时间线
```

---

## 扩展性设计

### 处理几十个月份的策略

| 月份数量 | 体验 |
|---------|-----|
| 1-12 个月 | 单年份,网格展示 |
| 13-24 个月 | 两个年份按钮,切换无感 |
| 50+ 个月 | 5+ 年份选择器,每次仅加载 12 个卡片 |

### 性能优化
- **懒加载图片**: Next.js Image 组件自动优化
- **按年分页**: 仅渲染当前年份的月份卡片
- **URL 状态管理**: 年份参数存在 URL,刷新保留状态
- **无需数据库**: 文件系统即数据源

---

## 用户体验细节

### 视觉层次
1. **最新3期**: 扇形卡片展示,中间放大(最高优先级)
2. **年份选择器**: 中等字号,清晰可点击
3. **往期卡片**: 统一尺寸,整齐网格

### 交互反馈
- 所有卡片支持 3D 鼠标跟随效果
- Hover 时卡片浮起,其他卡片轻微后退
- 年份切换不触发页面滚动(`scroll: false`)
- 弹簧动画提供自然的弹性反馈

### 信息密度
- 每个卡片显示:月份、Vol 编号、书籍数量
- 底部统计:当前年份总期数、总书籍数

---

## 添加新数据的流程

### 操作步骤
1. 在 `public/content/` 下创建新文件夹,如 `2026-01`
2. 添加 `metadata.json` 和书籍文件夹
3. 刷新页面即可看到新内容

### 自动化行为
- ✅ 自动识别新年份
- ✅ 自动添加到年份选择器
- ✅ 自动计算 Vol 编号
- ✅ 自动提取预览图
- ✅ 最新3期自动置顶展示
- ✅ 根据数据量自动切换布局(1/2/3卡片模式)

**无需修改任何代码!**

---

## 技术栈

- **框架**: Next.js 15 (App Router)
- **动画**: Framer Motion
- **样式**: Tailwind CSS + CSS Variables
- **类型**: TypeScript
- **数据源**: 文件系统(Node.js fs API)

---

## 未来可选增强

- [ ] 搜索功能(按书名/作者/年份)
- [ ] 卡片视图 / 列表视图切换
- [ ] 月份详情页预加载(Link prefetch)
- [ ] 深色模式主题切换
- [ ] 年份范围筛选器(如 2020-2023)
- [ ] VR 卡片查看模式(利用现有 3D 效果)
- [ ] 触摸设备陀螺仪联动(移动端倾斜卡片)
- [ ] 卡片翻转效果(显示背面统计信息)

---

## 实现记录

### 2025-01-22: 三卡片布局升级
- 从单卡片设计升级为智能1-3卡片自适应布局
- 新增三种显示模式:单卡片/双卡片/三卡片扇形
- 实现高级 3D 动效:
  - 鼠标跟随倾斜(useMotionValue + useTransform)
  - 扇形布局(中间放大1.2倍,两侧倾斜±8°)
  - 深度模糊和光效渐变
  - 弹簧动画进场效果
- 文件修改:
  - [app/page.tsx](app/page.tsx): 改为传递 `latestMonths` 数组
  - [components/MagazineCover.tsx](components/MagazineCover.tsx): 完整重构,新增 `SingleCard`/`DoubleCard`/`TripleCard` 子组件
