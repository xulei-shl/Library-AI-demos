# 产品需求文档 (PRD) - 书海回响 (Echoes of Books)

**版本**：2.0
**更新日期**：2025-11-21
**项目类型**：Web端书目推荐展示平台（响应式，优先适配桌面端）

---

## 1. 项目概述 (Project Overview)
本项目旨在为图书馆构建一个兼具**人文美学**与**自动化管理**的月度书目推荐网站。通过借阅数据与大模型筛选出的优质书目，将以“数字艺术卡片”的形式呈现。

网站核心隐喻为**“现代数字目录柜”**。摒弃传统列表的枯燥感，通过非线性交互（拖拽、堆叠）、优雅的动效（归档与释放）以及高品质的排版，打造博物馆级的沉浸式浏览体验。

---

## 2. 设计理念与视觉规范 (Design & Aesthetics)

### 2.1 核心隐喻
*   **无限档案室**：首页是整齐排列的目录柜抽屉，详情页是打开抽屉后思想散落的桌面。
*   **新理性主义 (Neo-Rationalism)**：拒绝拟物化（如木纹、把手），使用线条、几何色块、微阴影构建秩序感。

### 2.2 字体系统 (Typography)
严格执行以下字体规范，营造中西合璧的高级感：

*   **标题/大字 (Display)**
    *   **中文**：上图东观体
    *   **英文**：Playfair Display
    *   *应用*：月份标题、书名、Dock栏悬停文字。
*   **正文/元数据 (Body)**
    *   **中文**：又又意宋
    *   **英文**：EB Garamond 或 Noto Serif Display
    *   *应用*：内容简介、作者简介、目录、出版信息。
*   **点睛/手写 (Accent)**
    *   **中文**：润植家如印奏章楷
    *   **英文**：Cormorant Garamond Italic
    *   *应用*：人工推荐语、初评理由、引用句。

### 2.3 色彩与质感
*   **背景**：米白 (#F2F0E9) 或 暖灰，叠加 3% 透明度的噪点纹理 (Noise Texture)，模拟纸张触感。
*   **文字**：炭黑 (#2C2C2C)，避免纯黑。
*   **强调**：铁锈红或复古墨绿，用于推荐语背景或印章元素。

---

## 3. 页面交互流程 (User Interface & Interaction)

### 3.1 首页：目录柜 (The Archive)
*   **布局**：全屏网格系统 (Grid System)。每个网格代表一个“月度抽屉”。
*   **视觉元素**：
    *   网格内显示月份（上图东观体，如：*二零二三年 十月*）。
    *   角落标注期数（如：*Vol. 24*）。
    *   无多余装饰，仅靠极细的边框或内阴影区分。
*   **交互细节**：
    *   **Hover**：鼠标悬停时，网格背景微深，一张书目卡片的边角从网格边缘“探出”，暗示内容。
    *   **Click (转场动效)**：
        1.  点击某月网格。
        2.  **扩散 (Scale)**：该网格迅速放大填满屏幕，背景色平滑过渡。
        3.  **释放 (Burst)**：原本“藏”在抽屉里的多张书目卡片，从屏幕中心向四周炸开/发牌，伴随惯性旋转，最终散落在画布上。

### 3.2 详情页：沉浸画布 (The Canvas)

#### A. 散落状态 (Scatter State)
*   **展示**：所有推荐书目的卡片（约为原图30%尺寸）随机分布在屏幕上，角度随机倾斜。
*   **交互**：
    *   **拖拽**：用户可随意拖动卡片，松开有物理惯性。
    *   **层级**：被拖拽或悬停的卡片 Z-Index 提升。

#### B. 聚焦状态 (Focus State)
*   **触发**：点击任意一张卡片。
*   **动效**：
    *   被选卡片旋转回正，放大至左侧固定区域 (Left 40%)。
    *   其余卡片透明度降至 20%，作为背景。
    *   右侧信息面板 (Right 60%) 从下至上错峰浮现。

#### C. 右侧信息面板结构
信息从上至下排列，支持独立滚动：
1.  **头部**：`书名` (东观体) + `副标题` (又又意宋)。
2.  **评分**：`豆瓣评分` + 星级符号。
3.  **推荐语块 (视觉重心)**：
    *   优先显示 `人工推荐语`，若无则显示 `初评理由`。
    *   字体：**润植家如印奏章楷**。
    *   样式：带有底色块或引用符号装饰。
4.  **元数据栏 (两列)**：
    *   作者/译者 | 出版社/年份
    *   索书号 (高亮) | 页数
5.  **深度阅读 (折叠/展开)**：
    *   内容简介
    *   作者简介
    *   目录 (默认折叠)
6.  **操作栏**：
    *   下载按钮 (保存当前大图)。
    *   关闭按钮 (返回散落状态)。

#### D. 底部 Dock 栏
*   **位置**：屏幕底部居中，磨砂玻璃背景。
*   **内容**：横向排列当月所有书名的文字或微缩图。
*   **交互**：鼠标滑过产生“鱼眼放大”效果 (macOS Dock风格)，点击直接切换聚焦卡片。

---

## 4. 数据逻辑与自动化 (Data & Automation)

### 4.1 数据源与构建流程 (Data Source & Build Process)

#### A. 数据源目录 (Source Data)
原始数据存放于 `sources_data/YYYY-MM` 目录下，包含原始 Excel 表格及图片资源。

#### B. 构建脚本逻辑 (Build Script)
我们将创建一个脚本 `scripts/build-content.mjs` 来处理数据迁移与格式化。

**依赖**：`xlsx` (需在 `package.json` 中安装)

**输入**：月份参数（如 `2025-09`）

**处理流程**：
1.  **清理**：清空 `content/YYYY-MM` 目录，确保数据最新。
2.  **读取与筛选**：
    *   读取 `sources_data/YYYY-MM` 下的 `.xlsx` 文件。
    *   筛选出 `人工评选` 列为 `通过` 的所有行。
3.  **资源迁移**：
    *   遍历筛选出的书目，在 `content/YYYY-MM/` 下创建以 `书目条码` 命名的文件夹。
    *   将 `sources_data/.../[书目条码].png` 复制到新文件夹。
    *   在新文件夹内创建 `pic` 子目录，并将 `sources_data/.../pic/cover.jpg` 和 `qrcode.png` 复制进去。
4.  **元数据生成**：
    *   将原始 `.xlsx` 文件复制到 `content/YYYY-MM/` 并重命名为 `metadata.xlsx`。

#### C. 目标内容目录 (Target Content Structure)
构建脚本执行后，`content` 目录将呈现如下结构，供前端直接读取：

```text
/content
  /2025-09
    metadata.xlsx
    /54121109456737      <-- 子文件夹 (以书目条码命名)
      54121109456737.png  <-- 书目艺术卡片
      /pic
        cover.jpg       <-- 书籍封面原图
        qrcode.png      <-- 图书检索链接二维码
    /54121109456738
      ...
  /2025-08
    ...
```

### 4.2 Excel 字段映射表
系统读取 `metadata.xlsx`，根据以下逻辑渲染前端：
| :--- | :--- | :--- | :--- |
| **唯一标识/图片索引** | `书目条码` | 必须存在。用于匹配 `.jpg` 文件 | - |
| **主标题** | `豆瓣书名` | - | 上图东观体 |
| **副标题** | `豆瓣副标题` | 空值不显示 | 又又意宋 |
| **作者** | `豆瓣作者` | - | 又又意宋 |
| **译者** | `豆瓣译者` | 空值不显示 | 又又意宋 |
| **出版社** | `豆瓣出版社` | - | 又又意宋 |
| **出版年** | `豆瓣出版年` | - | 数字字体 |
| **页数** | `豆瓣页数` | - | 数字字体 |
| **评分** | `豆瓣评分` | - | 数字字体 |
| **索书号** | `索书号` | **核心业务数据**，需醒目 | 英文衬线体 |
| **ISBN** | `ISBN` | 显示在底部 | - |
| **推荐语** | `人工推荐语` | **Priority 1**。若为空，取下方字段 | 润植家如印奏章楷 |
| **推荐备选** | `初评理由` | **Priority 2**。 | 润植家如印奏章楷 |
| **简介** | `豆瓣内容简介` | 保留换行格式 | 又又意宋 |
| **作者简介** | `豆瓣作者简介` | - | 又又意宋 |
| **目录** | `豆瓣目录` | 前端需做“查看更多”折叠处理 | 又又意宋 |

---

## 5. 技术栈推荐 (Tech Stack)

*   **核心框架**: **Next.js** (React)
    *   *优势*：支持 SSG (静态生成)，构建时读取 Excel 生成 HTML，访问速度极快，SEO友好。
*   **动画库**: **Framer Motion**
    *   *优势*：完美处理 Layout Animation（从网格到全屏、从散落到聚焦的平滑过渡）。
*   **样式库**: **Tailwind CSS**
    *   *优势*：高效构建响应式布局与排版。
*   **数据解析**: **XLSX** (Node.js库)
    *   *优势*：构建阶段解析 Excel 文件。
*   **状态管理**: **Zustand**
    *   *优势*：管理“当前选中书籍”、“Z轴层级”等全局状态。

---

## 6. 开发注意事项 (Notes)

1.  **图片加载优化**：
    *   构建脚本应使用 `sharp` 库自动生成两套图：
        *   `thumbnail` (400px宽)：用于首页Hover、散落状态、Dock栏。
        *   `full` (原图)：仅在点击聚焦后加载，确保流畅度。
2.  **字体加载策略**：
    *   中文字体文件通常很大（如上图东观体）。必须使用 **Font Subsetting (字体子集化)** 技术，仅打包页面中用到的字符，或使用系统字体作为降级方案，防止页面白屏。
3.  **容错处理**：
    *   如果 Excel 中有记录但文件夹内无对应图片，构建脚本应报警并跳过该条目，避免前端报错。
    *   如果推荐语字段均为空，前端应隐藏推荐语板块，调整布局间距。