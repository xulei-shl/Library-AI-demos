# Metadata Editor 项目说明

## 1. 项目概述

本项目是一个基于 Python 和 Streamlit 构建的元数据编辑工具，专用于图书馆或机构管理和编辑演艺事件的元数据。它通过一个交互式的 Web界面，实现了对存储在 SQLite 数据库中数据的浏览、编辑和版本控制。项目集成了大型语言模型（LLM）和外部知识库，为元数据处理、实体关联和内容问答等任务提供智能辅助。

## 2. 核心功能

- **数据加载与持久化**: 从 SQLite 数据库加载数据，并能将修改后的数据持久化保存，同时记录版本历史。
- **交互式Web界面**: 使用 Streamlit 构建，提供数据加载、实体编辑、词表管理等多个功能页面。
- **实体编辑**: 提供丰富的表单控件，用于编辑演出事件、场地、参与团体、作品、演职人员等复杂嵌套的元数据结构。
- **AI 辅助**:
    - **实体链接**: 可调用外部API（如人名规范库）进行实体链接。
    - **知识库问答**: 集成 Dify 等平台，实现基于特定知识库的问答。
    - **通用AI问答**: 支持调用多种大模型 API（如 SiliconFlow, Zhipu AI）进行开放式问答。
- **词表管理**: 提供对事件类型、实体关系类型等多种词表的增删改查功能，词表存储于数据库中。
- **配置化管理**: 对大模型、知识库和提示词（Prompts）进行JSON文件配置化管理，方便用户自定义。

## 3. 项目结构

```
/
├── main.py                # Streamlit 应用的主入口，负责页面导航
├── api_utils.py           # 封装与 LLM 和外部知识库 API 的通信
├── data_browsing.py       # “实体编辑”页面的核心逻辑
├── data_loading.py        # “数据加载”页面的核心逻辑
├── utils.py               # 通用工具函数，如数据库操作
├── jsondata/              # 存放各类JSON配置文件
│   ├── llm_settings.json     # 大模型API配置
│   ├── knowledge_settings.json # 知识库配置
│   └── prompts.json          # 预设的提示语
└── tools/                 # 存放各类后台工具和管理脚本
    ├── create_database.py    # 初始化数据库和表结构
    ├── json2sql.py           # 将JSON文件导入到SQLite数据库
    ├── type_settings.py      # 事件类型词表管理界面
    └── ...                   # 其他管理页面和脚本
```

## 4. 快速开始

1.  **环境准备**: 确保已安装 Python 及 `requirements.txt` 中声明的依赖库（如 `streamlit`, `openai`, `requests`）。
2.  **配置API**: 在项目根目录创建 `.env` 文件，并填入所需的大模型及外部知识库的 API Key 和 URL。
3.  **初始化数据库**: 如果是首次运行，需要先准备好数据文件，并执行 `tools/json2sql.py` 脚本，它将创建数据库并将数据导入。
4.  **运行应用**: 在项目根目录下执行以下命令：
    ```bash
    streamlit run main.py
    ```
5.  **使用**: 在浏览器中打开应用，通过侧边栏导航至不同功能页面进行操作。首先在“数据加载”页面加载数据，然后切换到“实体编辑”页面进行浏览和修改。

